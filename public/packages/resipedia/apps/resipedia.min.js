'use strict';String.prototype.toASCII=function(){for(var a,b=this.toLocaleLowerCase(),c='',d={192:'A',193:'A',194:'A',195:'A',196:'A',197:'A',224:'a',225:'a',226:'a',227:'a',228:'a',229:'a',200:'E',201:'E',202:'E',203:'E',232:'e',233:'e',234:'e',235:'e',204:'I',205:'I',206:'I',207:'I',236:'i',237:'i',238:'i',239:'i',210:'O',211:'O',212:'O',213:'O',214:'O',216:'O',240:'o',242:'o',243:'o',244:'o',245:'o',246:'o',217:'U',218:'U',219:'U',220:'U',249:'u',250:'u',251:'u',252:'u'},e=0;e<b.length;e++)a=b.charCodeAt(e),128>a?c+=b.charAt(e):'undefined'!=typeof d[a]&&(c+=d[a]);return c},String.prototype.toURL=function(){var a=this.toASCII();return a.replace(/[^a-z\'\s-]/gi,'').replace(/[\s-\']+/g,'-').replace(/-*$/,'')},String.prototype.base64EncodeUrl=function(){var a=this;return a=window.btoa(unescape(encodeURIComponent(a))),a.replace(/\+/g,'-').replace(/\//g,'_').replace(/\=+$/,'')},String.prototype.base64DecodeUrl=function(){var a=this,b=a+'===';return a=b.slice(0,a.length+a.length%4),a=a.replace(/-/g,'+').replace(/_/g,'/'),decodeURIComponent(escape(window.atob(a)))},function(){var a='=',b=[-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,62,-1,-1,-1,63,52,53,54,55,56,57,58,59,60,61,-1,-1,-1,0,-1,-1,-1,0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,-1,-1,-1,-1,-1,-1,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,-1,-1,-1,-1,-1],c='ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_'.split('');String.prototype.base64_decode=function(){for(var c='',d=this,e=0,f=0,g=0;g<d.length;g+=1){var h=d.charCodeAt(g),i=b[127&h];if(10!=h&&13!=h){if(-1===i)return null;f=f<<6|i,e+=6,e>=8&&(e-=8,a!==d.charAt(g)&&(c+=String.fromCharCode(f>>e&255)),f&=(1<<e)-1)}}return e?null:c},String.prototype.base64_encode=function(){var b,d,e,f='',g=this;if(g.length<3)return null;for(b=0,d=g.length-2;d>b;b+=3){var h=g.charCodeAt(b),i=g.charCodeAt(b+1),j=g.charCodeAt(b+2);f+=c[h>>2],f+=c[((3&h)<<4)+(i>>4)],f+=c[((15&i)<<2)+(j>>6)],f+=c[63&j]}if(e=g.length%3,0!==e){b=g.length-e,f+=c[g[b+0]>>2];var h=g.charCodeAt(b),i=g.charCodeAt(b+1);2===e?(f+=c[((3&h)<<4)+(i>>4)],f+=c[(15&i)<<2],f+=a):(f+=c[(3&h)<<4],f+=a+a)}return f}}();var resiway=angular.module('resipedia',['ngRoute','ngSanitize','ngCookies','ngAnimate','ngFileUpload','ui.bootstrap','ui.tinymce','oi.select','pascalprecht.translate','btford.markdown','angularMoment','ngToast','ngHello']).config(['ngToastProvider',function(a){a.configure({animation:'fade'})}]).config(function(){moment.updateLocale(global_config.locale,{calendar:{sameElse:'LLL'}})}).config(['$translateProvider',function(a){'undefined'!=typeof translations&&(console.log('translations loaded'),a.translations(global_config.locale,translations).preferredLanguage(global_config.locale).useSanitizeValueStrategy(['sanitizeParameters']))}]).config(['$httpProvider','$httpParamSerializerJQLikeProvider',function(a,b){a.defaults.headers.post['Content-Type']='application/x-www-form-urlencoded;charset=utf-8',a.defaults.paramSerializer='$httpParamSerializerJQLike',a.defaults.transformRequest.unshift(b.$get())}]).config(['$locationProvider',function(a){a.html5Mode({enabled:!0,requireBase:!0,rewriteLinks:!0}).hashPrefix('!')}]).config(['helloProvider',function(a){a.init({facebook:'1786954014889199',google:'900821912326-epas7m1sp2a85p02v8d1i21kcktp7grl.apps.googleusercontent.com',twitter:'6MV5s7IYX2Uqi3tD33s9VSEKb',lescommuns:'resiway.org'},{scope:'basic, email',redirect_uri:'oauth2callback',oauth_proxy:'https://auth-server.herokuapp.com/proxy'})}]).factory('httpRequestInterceptor',['$cookies',function(a){return{request:function(b){return b.headers.Authorization='Bearer '+a.get('access_token'),b}}}]).config(['$httpProvider',function(a){a.interceptors.push('httpRequestInterceptor')}]).run(['$window','$timeout','$rootScope','$location','$cookies','$http','authenticationService','actionService','feedbackService','hello',function(a,b,c,d,e,f,g,h,i,j){console.log('run method invoked'),c.popover=i;const k='/user/sign';c.viewContentLoading=!0,c.pendingAction=null,c.previousPath='/',c.currentPath=null,c.search={"default":{q:'',domain:[],order:'created',sort:'desc',start:0,limit:25,total:-1},criteria:{}},angular.merge(c.search.criteria,c.search["default"]),c.config=angular.extend({application:'resiway',locale:'fr',channel:1},global_config),c.user={id:0},c.$on('$locationChangeStart',function(a){c.viewContentLoading=!0}),c.$on('$locationChangeSuccess',function(a){console.log('$locationChangeSuccess'),c.currentPath&&c.currentPath.substring(0,k.length)!=k&&(c.previousPath=c.currentPath),c.currentPath=d.path(),console.log('previous path: '+c.previousPath),console.log('current path: '+c.currentPath)}),c.$on('$viewContentLoaded',function(d){console.log('$viewContentLoaded received'),c.viewContentLoading=!1,b(function(){console.log('scroll to top'),a.scrollTo(0,0),0==c.user.id&&c.previousPath.substring(0,k.length)==k&&c.currentPath.substring(0,k.length)!=k&&(console.log('pending action disgarded'),c.pendingAction=null),c.pendingAction&&c.currentPath.substring(0,k.length)!=k&&(console.log('continuing ation'),console.log(c.pendingAction),c.pendingAction.scope=d.targetScope,h.perform(c.pendingAction))})}),g.authenticate(),j.init({lescommuns:{oauth:{version:'2',auth:'https://login.lescommuns.org/auth/realms/master/protocol/openid-connect/auth',grant:'https://login.lescommuns.org/auth/realms/master/protocol/openid-connect/token'},scope:{basic:'openid email'},response_type:'token id_token',login:function(a){a.qs.nonce=''+Math.floor(1e5*Math.random()+1)}}}),j.on("auth.login",function(a){console.log('auth notification received in rootscope'),console.log(a),angular.isDefined(a.authResponse)&&angular.isDefined(a.authResponse.network)&&angular.isDefined(a.authResponse.access_token)&&f.get('index.php?do=resiway_user_auth&network_name='+a.authResponse.network+'&network_token='+a.authResponse.access_token).then(function(a){a.data;g.authenticate().then(function(a){c.$broadcast('auth.signed')},function(a){console.log(a)})},function(a){data.error_message_ids[0];console.log(a)})})}]).controller('rootController',['$rootScope','$scope','$location','$route','$http',function(a,b,c,d,e){console.log('root controller');var f=this;f.tinymceOptions={inline:!1,plugins:'wordcount charcount advlist autolink link image lists charmap fullscreen preview table paste code',skin:'lightgray',theme:'modern',content_css:'packages/resipedia/apps/assets/css/bootstrap.min.css',elementpath:!1,block_formats:"Paragraph=p;Heading 1=h3;Heading 2=h4;Heading 3=h5;",formats:{bold:{inline:'b'},italic:{inline:'i'},underline:{inline:'u'}},menu:{edit:{title:'Edit',items:'undo redo | cut copy paste pastetext | selectall'},format:{title:'Format',items:'bold italic underline strikethrough superscript subscript | charmap | removeformat'}},menubar:!1,toolbar:"fullscreen code | undo redo | bold italic | headings formatselect | blockquote bullist numlist outdent indent | link image | table",toggle_fullscreen:!1,setup:function(a){a.on("init",function(){angular.element(a.editorContainer).addClass('form-control')}),a.on("focus",function(){angular.element(a.editorContainer).addClass('focused')}),a.on("blur",function(){angular.element(a.editorContainer).removeClass('focused')}),a.on('FullscreenStateChanged',function(){console.log('fs'),f.tinymceOptions.toggle_fullscreen=!f.tinymceOptions.toggle_fullscreen,f.tinymceOptions.toggle_fullscreen?angular.element(a.editorContainer).addClass('mt-2'):angular.element(a.editorContainer).removeClass('mt-2')})}},f.searchByCategory=function(b){a.category=b,f.search({q:'['+b.title_url+']'})},f.search=function(b){var e=angular.extend({},a.search["default"],b||{});angular.copy(e,a.search.criteria);var f='/search';c.path()==f?(a.$broadcast('$locationChangeStart'),d.reload()):c.path(f)},f.makeLink=function(a,b,c){switch(arguments.length<3&&(c=''),a){case'resiway\\Author':return'#!/author/'+b+'/'+c;case'resiway\\Category':return'#!/category/'+b+'/'+c;case'resiexchange\\Question':return'/question/'+b+'/'+c;case'resiexchange\\Answer':return'/answer/'+b+'/'+c;case'resiexchange\\QuestionComment':return'/questionComment/'+b+'/'+c;case'resiexchange\\AnswerComment':return'/answerComment/'+b+'/'+c;case'resilib\\Document':return'/document/'+b+'/'+c;case'resilexi\\Article':return'/article/'+c}},f.avatarURL=function(a,b){var c=new String(a);return c.replace(/@size/g,b)},f.htmlToTxt=function(a){var b=new String(a);return b.replace(/<[^>]*>/g,'').replace(/\./,".\n")},f.htmlToURL=function(a){var b=new String(a);return encodeURIComponent(b.replace(/<[^>]*>/g,'').replace(/\./,".\n"))},f.humanReadable={month:function(a){var b='',c=Date.parse(a);if(NaN!=c){var d=new Date(c);b=d.toLocaleString('fr',{year:'numeric',month:'long'})}return b},date:function(a){var b='',c=Date.parse(a);if(NaN!=c){var d=new Date(c);b=d.toLocaleString('fr',{weekday:'long',year:'numeric',month:'short',day:'numeric'})}return b},datetime:function(a){var b='',c=Date.parse(a);if(NaN!=c){var d=new Date(c);b=d.toLocaleString('fr',{weekday:'long',year:'numeric',month:'short',day:'numeric',hour:'numeric',minute:'numeric'})}return b},dateInterval:function(a){var b='',c=new Date,d=Date.parse(a);if(NaN!=d){var e=new Date(d),f=Math.floor((c-e)/864e5);if(0==f)return'today';if(7>f)return 1==f?'yesterday':f+" days ago";if(30>f){var g=Math.floor(f/7);return 1==g?'last week':g+" weeks ago"}if(365>f){var h=Math.floor(f/30);return 1==h?'last month':h+" months ago"}var i=Math.floor(f/365);return 1==i?'last year':i+" years ago"}return b},timeElapsed:function(a){var b='',c=new Date,d=Date.parse(a);if(NaN!=d){var e=new Date(d),f=Math.floor((c-e)/864e5);if(0==f)return'today';if(7>f)return f+" days";if(30>f){var g=Math.floor(f/7);return g+" weeks"}if(365>f){var h=Math.floor(f/30);return h+" months"}var i=Math.floor(f/365);return i+" years"}return b},number:function(a){if('undefined'==typeof a||'number'!=typeof parseInt(a))return 0;if(0==a)return 0;a=+a;var b=a/Math.abs(a);a=Math.abs(a);var c=['','k','M','G'],d=Math.floor(Math.log(a)/Math.log(1e3));return b*(0>=d?a:(a/Math.pow(1e3,d)).toFixed(1))+c[d]}},b.selectMatch=function(a,b,c,d){f.search({q:c})},b.getKeywords=function(a){return e.get('index.php?get=resiway_index_list',{params:{q:a}}).then(function(a){return a.data.result})}}]);angular.module('resipedia').service('routeObjectProvider',['$http','$route','$q',function(a,b,c){return{provide:function(d){var e=c.defer();return e.resolve({}),'undefined'==typeof b.current.params.id||0==b.current.params.id?e.promise:a.get('index.php?get='+d+'&id='+b.current.params.id).then(function(a){var b=a.data;return'object'!=typeof b.result?{}:b.result},function(a){return e.promise})}}}]).service('routeCategoryProvider',['routeObjectProvider',function(a){this.load=function(){return a.provide('resiway_category')}}]).service('routeCategoriesProvider',['$http','$rootScope',function(a,b){this.load=function(){return a.get('index.php?get=resiway_category_list&channel='+b.config.channel).then(function(a){var b=a.data;return'object'!=typeof b.result?[]:b.result},function(a){return[]})}}]).service('routeArticlesProvider',['$http','$rootScope','$httpParamSerializerJQLike',function(a,b,c){this.load=function(){return a.get('index.php?get=resilexi_article_list&'+c(b.search.criteria)+'&channel='+b.config.channel).then(function(a){var c=a.data;return'object'!=typeof c.result?(b.search.criteria.total=0,[]):(b.search.criteria.total=c.total,c.result)},function(a){return b.search.criteria.total=0,[]})}}]).service('routeArticleProvider',['routeObjectProvider','$sce',function(a,b){this.load=function(){return a.provide('resilexi_article').then(function(a){var c={commentsLimit:5,newCommentShow:!1,newCommentContent:''};return angular.isDefined(a.articles)?angular.forEach(a.articles,function(d,e){a.articles[e].content=b.trustAsHtml(a.articles[e].content),angular.extend(a.articles[e],c)}):(angular.extend(a,c),a.content=b.trustAsHtml(a.content)),a})}}]).service('routeDocumentsProvider',['$http','$rootScope','$httpParamSerializerJQLike',function(a,b,c){this.load=function(){return a.get('index.php?get=resilib_document_list&'+c(b.search.criteria)+'&channel='+b.config.channel).then(function(a){var c=a.data;return'object'!=typeof c.result?(b.search.criteria.total=0,[]):(b.search.criteria.total=c.total,c.result)},function(a){return b.search.criteria.total=0,[]})}}]).service('routeDocumentProvider',['routeObjectProvider','$sce',function(a,b){this.load=function(){return a.provide('resilib_document').then(function(a){var c={commentsLimit:5,newCommentShow:!1,newCommentContent:'',newAnswerContent:''};return angular.extend(a,c),a.description=b.trustAsHtml(a.description),a})}}]).service('routeQuestionsProvider',['$http','$rootScope','$httpParamSerializerJQLike',function(a,b,c){this.load=function(){return a.get('index.php?get=resiexchange_question_list&'+c(b.search.criteria)+'&channel='+b.config.channel).then(function(a){var c=a.data;return'object'!=typeof c.result?(b.search.criteria.total=0,[]):(b.search.criteria.total=c.total,c.result)},function(a){return b.search.criteria.total=0,[]})}}]).service('routeQuestionProvider',['routeObjectProvider','$sce',function(a,b){this.load=function(){return a.provide('resiexchange_question').then(function(a){var c={commentsLimit:5,newCommentShow:!1,newCommentContent:'',newAnswerContent:''};return angular.extend(a,c),a.content=b.trustAsHtml(a.content),angular.forEach(a.answers,function(d,e){a.answers[e].content=b.trustAsHtml(a.answers[e].content),angular.extend(a.answers[e],c)}),a})}}]).service('routeAnswerProvider',['routeObjectProvider','$sce',function(a,b){this.load=function(){return a.provide('resiexchange_answer').then(function(a){return a.content=b.trustAsHtml(a.content),a})}}]).service('routeUsersProvider',['$http','$rootScope',function(a,b){this.load=function(){return a.get('index.php?get=resiway_user_list&order=reputation').then(function(a){var b=a.data;return'object'!=typeof b.result?[]:b.result},function(a){return[]})}}]).service('routeUserProvider',['routeObjectProvider',function(a){this.load=function(){return a.provide('resiway_user')}}]).service('routeAuthorProvider',['routeObjectProvider',function(a){this.load=function(){return a.provide('resiway_author')}}]).service('routeAuthorByNameProvider',['$http','$route','$q',function(a,b,c){this.load=function(){var d=c.defer();d.resolve({});var e=new String(b.current.params.name);return'undefined'==typeof b.current.params.name||0==e.length?d.promise:a.get('index.php?get=resiway_author&name='+e).then(function(a){var b=a.data;return b.result},function(a){return[]})}}]).service('routeHelpTopicProvider',['routeObjectProvider','$sce',function(a,b){this.load=function(){return a.provide('resiexchange_help_topic').then(function(a){return a.content=b.trustAsHtml(a.content),a})}}]).service('routeHelpCategoryProvider',['routeObjectProvider',function(a){this.load=function(){return a.provide('resiexchange_help_category')}}]).service('routeHelpCategoriesProvider',['routeObjectProvider','$http',function(a,b){this.load=function(){return b.get('index.php?get=resiexchange_help_category_list&order=title').then(function(a){var b=a.data;return'object'!=typeof b.result?[]:b.result},function(a){return[]})}}]).service('routeBadgesProvider',['routeObjectProvider','$http',function(a,b){this.load=function(){return b.get('index.php?get=resiway_badge_list&order=name').then(function(a){var b=a.data;return'object'!=typeof b.result?[]:b.result},function(a){return[]})}}]).service('routeBadgeCategoriesProvider',['routeObjectProvider','$http',function(a,b){this.load=function(){return b.get('index.php?get=resiway_badgecategory_list&order=name').then(function(a){var b=a.data;return'object'!=typeof b.result?[]:b.result},function(a){return[]})}}]).service('routeSearchProvider',['$http','$rootScope','$httpParamSerializerJQLike',function(a,b,c){this.load=function(){return a.get('index.php?get=resiway_search&'+c(b.search.criteria)+'&channel='+b.config.channel).then(function(a){var c=a.data;return'object'!=typeof c.result?(b.search.criteria.total=0,[]):(b.search.criteria.total=c.total,c.result)},function(a){return b.search.criteria.total=0,[]})}}]).service('authenticationService',['$rootScope','$http','$q','$cookies',function(a,b,c,d){var e=this;e.last_auth_time=0,e.max_auth_delay=3e5,this.userId=function(){var a=c.defer();return b.get('index.php?get=resiway_user_id').then(function(b){'undefined'!=typeof b.data.result&&b.data.result>0?(e.last_auth_time=(new Date).getTime(),a.resolve(b.data.result)):a.reject()},function(b){a.reject()}),a.promise},this.userData=function(a){var d=c.defer();return b.get('index.php?get=resiway_user&id='+a).success(function(b,c,e,f){'object'==typeof b&&'object'==typeof b.result&&b.result.id==a?d.resolve(b.result):d.reject()}).error(function(a,b,c,e){d.reject()}),d.promise},this.setCredentials=function(a,b,c){},this.clearCredentials=function(){console.log('clearing credentials')},this.signout=function(){a.user={id:0},d.remove('access_token'),localStorage&&localStorage.removeItem('hello')},this.signin=function(f,g){var h=c.defer();return b.get('index.php?do=resiway_user_signin&login='+f+'&password='+g).then(function(b){return'undefined'==typeof b.data.result?h.reject({result:-1}):b.data.result<0?h.reject(b.data):(e.last_auth_time=(new Date).getTime(),console.log(d.put('access_token')),e.userData(b.data.result).then(function(b){return a.user=b,h.resolve(b)},function(a){return console.log('something went wrong server-side'),h.reject(a)}))},function(a){return h.reject({result:-1})}),h.promise},this.register=function(a,d){var e=c.defer();return b.get('index.php?do=resiway_user_signup&login='+a+'&firstname='+d).then(function(a){return a.data.result<0?e.reject(a.data):e.resolve(a.data.result)},function(a){return e.reject({result:-1})}),e.promise},this.authenticate=function(){var b=c.defer();return e.userId().then(function(c){a.user.id>0?b.resolve(a.user):e.userData(c).then(function(c){a.user=c,b.resolve(c)},function(a){console.log('something went wrong server-side'),b.reject(a)})},function(){b.reject()}),b.promise}}]).service('actionService',['$rootScope','$http','$location','authenticationService','ngToast',function(a,b,c,d,e){this.perform=function(f){var g={action:'',data:'',next_path:c.path(),scope:null,callback:function(a,b){}},h=angular.extend({},g,f);d.authenticate().then(function(){a.pendingAction=null,'undefined'!=typeof h.action&&h.action.length>0&&b.post('index.php?do='+h.action,h.data).then(function(c){'function'==typeof h.callback&&h.callback(h.scope,c.data),b.get('index.php?do=resiway_user_badges_update').then(function(c){b.get('index.php?get=resiway_user_notifications').then(function(b){var c=b.data;'object'==typeof c.result&&a.user.id>0&&(a.user.notifications=a.user.notifications.concat(c.result),angular.forEach(c.result,function(a,b){e.create({content:a.content,className:'success',dismissOnTimeout:!0,timeout:7e3,dismissButton:!0,dismissButtonHtml:'&times',dismissOnClick:!1,compileContent:!1})}))})})},function(){})},function(){a.pendingAction=h,c.hash(''),c.path('/user/sign')})}}]).service('feedbackService',['$window','$timeout',function(a,b){function c(){e.elem&&(e.elem.triggerHandler('toggle-popover'),e.elem=null)}function d(a){for(var b=angular.element(a),c=angular.element(document.body);('undefined'==typeof b.attr('id')||'undefined'==typeof b.attr('uib-popover-template'))&&(b=b.parent(),b!=c););return'#'+b.attr('id')}var e={content:'',elem:null,classname:null,id:null};return{content:function(){return e.content},classname:function(){var a=document.querySelector('#'+e.id);if(a&&'undefined'!=typeof a){var b=angular.element(a);b.parent().parent().parent().addClass(e.classname)}return e.classname},id:function(){return e.id},popover:function(d,f,g,h,i){function j(a){var b=a.getBoundingClientRect(),c=window.pageXOffset||document.documentElement.scrollLeft,d=window.pageYOffset||document.documentElement.scrollTop;return{top:b.top+d,left:b.left+c}}c();var k=angular.element(document.querySelector(d));e.content=f,e.elem=k,e.id='popover-'+k.attr('id'),e.classname='popover-'+(g||'danger');var l=j(k[0]).top;(l<a.pageYOffset||l>a.pageYOffset+a.innerHeight)&&a.scrollTo(0,l-a.innerHeight/5),f.length>0&&(k.triggerHandler('toggle-popover'),e.is_open=!0,h&&b(function(){c()},i||3e3))},close:function(){c()},selector:function(a){return c(),d(a)}}}]),angular.module('resipedia').config(['$routeProvider','$routeParamsProvider','$httpProvider',function(a,b,c){var d='',e={'/help/categories':'/aide/categories','/help/category/edit/:id':'/aide/categorie/edition/:id','/help/category/:id/:title?':'/aide/categorie/:id/:title?','/help/topic/edit/:id':'/aide/sujet/edition/:id','/help/topic/:id/:title?':'/aide/sujet/:id/:title?','/category/edit/:id':'/categorie/edition/:id','/category/:id/:title?':'/categorie/:id/:title?','/categories':'/categories','/badges':'/badges','/search':'/recherche','/article/edit/:id':'/article/edition/:id','/article/:id/:title?':'/article/:id/:title?','/articles':'/articles','/document/edit/:id':'/document/edition/:id','/document/:id/:title?':'/document/:id/:title?','/documents':'/documents','/questions':'/questions','/question/edit/:id':'/question/edition/:id','/question/:id/:title?':'/question/:id/:title?','/answer/edit/:id':'/reponse/edition/:id','/answer/:id':'/reponse/:id','/questionComment/:id':'/commentaireQuestion/:id','/answerComment/:id':'/commentaireResponse/:id','/users':'/participants','/user/current/profile':'/participant/courant/profil','/user/current/edit':'/participant/courant/edition','/user/password/:code?':'/participant/password/:code?','/user/confirm/:code':'/participant/confirmation/:code','/user/notifications/:id':'/participant/notifications/:id','/user/edit/:id':'/participant/edition/:id','/user/:id/:name?':'/participant/:id/:name?','/author/edit/:id':'/auteur/edition/:id','/author/:id/:name?':'/auteur/:id/:name?','/association/soutenir':'/association/soutenir','/association/contact':'/association/contact','/association/participer':'/association/participer','/association/mentions-legales':'/association/mentions-legales','/association/ils-nous-soutiennent':'/association/ils-nous-soutiennent','/association':'/association'},f={'/help/categories':{templateUrl:d+'helpCategories.html',controller:'helpCategoriesController as ctrl',resolve:{categories:['routeHelpCategoriesProvider',function(a){return a.load()}]}},'/help/category/edit/:id':{templateUrl:d+'helpCategoryEdit.html',controller:'helpCategoryEditController as ctrl',resolve:{category:['routeHelpCategoryProvider',function(a){return a.load()}]}},'/help/category/:id/:title?':{templateUrl:d+'helpCategory.html',controller:'helpCategoryController as ctrl',resolve:{category:['routeHelpCategoryProvider',function(a){return a.load()}]}},'/help/topic/edit/:id':{templateUrl:d+'helpTopicEdit.html',controller:'helpTopicEditController as ctrl',resolve:{topic:['routeHelpTopicProvider',function(a){return a.load()}],categories:['routeHelpCategoriesProvider',function(a){return a.load()}]}},'/help/topic/:id/:title?':{templateUrl:d+'helpTopic.html',controller:'helpTopicController as ctrl',resolve:{topic:['routeHelpTopicProvider',function(a){return a.load()}],categories:['routeHelpCategoriesProvider',function(a){return a.load()}]}},'/badges':{templateUrl:d+'badges.html',controller:'badgesController as ctrl',resolve:{categories:['routeBadgeCategoriesProvider',function(a){return a.load()}]}},'/search':{templateUrl:d+'search.html',controller:'searchController as ctrl',resolve:{search:['routeSearchProvider',function(a){return a.load()}]}},'/categories':{templateUrl:d+'categories.html',controller:'categoriesController as ctrl'},'/category/edit/:id':{templateUrl:d+'categoryEdit.html',controller:'categoryEditController as ctrl',resolve:{category:['routeCategoryProvider',function(a){return a.load()}]}},'/category/:id/:title?':{templateUrl:d+'category.html',controller:'categoryController as ctrl',resolve:{category:['routeCategoryProvider',function(a){return a.load()}]}},'/articles':{templateUrl:d+'articles.html',controller:'articlesController as ctrl',resolve:{articles:['routeArticlesProvider',function(a){return a.load()}]}},'/article/edit/:id':{templateUrl:d+'articleEdit.html',controller:'articleEditController as ctrl',resolve:{article:['routeArticleProvider',function(a){return a.load()}]}},'/article/:id/:title?':{templateUrl:d+'article.html',controller:'articleController as ctrl',resolve:{article:['routeArticleProvider',function(a){return a.load()}]}},'/documents':{templateUrl:d+'documents.html',controller:'documentsController as ctrl',resolve:{documents:['routeDocumentsProvider',function(a){return a.load()}]}},'/document/edit/:id':{templateUrl:d+'documentEdit.html',controller:'documentEditController as ctrl',resolve:{document:['routeDocumentProvider',function(a){return a.load()}]}},'/document/:id/:title?':{templateUrl:d+'document.html',controller:'documentController as ctrl',resolve:{document:['routeDocumentProvider',function(a){return a.load()}]}},'/questions':{templateUrl:d+'questions.html',controller:'questionsController as ctrl',resolve:{questions:['routeQuestionsProvider',function(a){return a.load()}]}},'/question/edit/:id':{templateUrl:d+'questionEdit.html',controller:'questionEditController as ctrl',resolve:{question:['routeQuestionProvider',function(a){return a.load()}]}},'/question/:id/:title?':{templateUrl:d+'question.html',controller:'questionController as ctrl',resolve:{question:['routeQuestionProvider',function(a){return a.load()}]}},'/answer/edit/:id':{templateUrl:d+'answerEdit.html',controller:'answerEditController as ctrl',resolve:{answer:['routeAnswerProvider',function(a){return a.load()}]}},'/answer/:id':{templateUrl:d+'question.html',controller:['$location','routeAnswerProvider',function(a,b){b.load().then(function(b){a.path('/question/'+b.question_id)})}]},'/questionComment/:id':{templateUrl:d+'question.html',controller:['$location','routeObjectProvider',function(a,b){b.provide('resiexchange_questioncomment').then(function(b){a.path('/question/'+b.question_id)})}]},'/answerComment/:id':{templateUrl:d+'question.html',controller:['$location','routeObjectProvider',function(a,b){b.provide('resiexchange_answercomment').then(function(b){a.path('/question/'+b['answer_id.question_id'])})}]},'/users':{templateUrl:d+'users.html',controller:'usersController as ctrl',resolve:{users:['routeUsersProvider',function(a){return a.load()}]}},'/user/current/profile':{templateUrl:d+'userProfile.html',controller:['$location','authenticationService',function(a,b){b.userId().then(function(b){a.path('/user/profile/'+b)})}]},'/user/current/edit':{templateUrl:d+'userEdit.html',controller:['$location','authenticationService',function(a,b){b.userId().then(function(b){a.path('/user/edit/'+b)})}]},'/user/password/:code?':{templateUrl:d+'userPassword.html',controller:'userPasswordController as ctrl'},'/user/confirm/:code':{templateUrl:d+'userConfirm.html',controller:'userConfirmController as ctrl'},'/user/notifications/:id':{templateUrl:d+'userNotifications.html',controller:'userNotificationsController as ctrl'},'/user/sign/:mode?':{templateUrl:d+'userSign.html',controller:'userSignController as ctrl',reloadOnSearch:!1},'/user/profile/:id/:name?':{redirectTo:'/user/:id/:name?'},'/user/edit/:id':{templateUrl:d+'userEdit.html',controller:'userEditController as ctrl',resolve:{user:['routeUserProvider',function(a){return a.load()}]}},'/user/:id/:name?':{templateUrl:d+'userProfile.html',controller:'userProfileController as ctrl',resolve:{user:['routeUserProvider',function(a){return a.load()}]}},'/author/edit/:id':{templateUrl:d+'authorEdit.html',controller:'authorEditController as ctrl',resolve:{author:['routeAuthorProvider',function(a){return a.load()}]}},'/author/:id/:name?':{templateUrl:d+'author.html',controller:'authorController as ctrl',resolve:{author:['routeAuthorProvider',function(a){return a.load()}]}},'/association/soutenir':{templateUrl:d+'support.html',controller:'homeController as ctrl'},'/association/contact':{templateUrl:d+'contact.html',controller:'emptyController as ctrl'},'/association/participer':{templateUrl:d+'participate.html',controller:'emptyController as ctrl'},'/association/mentions-legales':{templateUrl:d+'legal.html',controller:'emptyController as ctrl'},'/association/ils-nous-soutiennent':{templateUrl:d+'supporters.html',controller:'emptyController as ctrl'},'/association':{templateUrl:d+'organisation.html',controller:'emptyController as ctrl'}};angular.forEach(f,function(b,c){var d=c;'undefined'!=typeof e[c]?d=e[c]:console.warn('missing translation for route '+c),c!=d&&a.when(c,{redirectTo:d}),a.when(d,f[c])}),a.otherwise({templateUrl:d+'home.html',controller:'homeController as ctrl'})}]),angular.module('resipedia').filter("nl2br",function(){return function(a){return a?a.replace(/\n\r?/g,'<br />'):a}}).filter('size',function(){return function(a,b){return a=a||'',a.replace(new RegExp('<size>','gi'),b)}}).filter("humanizeCount",function(){return function(a,b){if(b)return a.toString().replace(/\B(?=(\d{3})+(?!\d))/g,".");if('undefined'==typeof a||'number'!=typeof parseInt(a))return 0;if(0==a)return 0;var c=a/Math.abs(a);a=Math.abs(a);var d=['','k','M','G'],e=Math.floor(Math.log(a)/Math.log(1e3));return c*(0>=e?a:(a/Math.pow(1e3,e)).toFixed(1))+d[e]}}).filter('customSearchFilter',['$sce',function(a){return function(b,c,d,e,f){var g='<span class="close select-search-list-item_selection-remove">×</span>';return a.trustAsHtml(d.title+g)}}]).filter('customDropdownFilter',['$sce','oiSelectEscape',function(a,b){return function(c,d,e){var f,c=new String(e.title),g=new String(e.path);return d.length>0||angular.isNumber(d)?(d=b(d),f=c.replace(new RegExp(d,'gi'),'<strong>$&</strong>')+' <span style="color: grey; font-style: italic; font-size: 80%;">('+g.replace(new RegExp(d,'gi'),'<strong>$&</strong>')+')</span>'):f=c+" <span style=\"color: grey; font-style: italic; font-size: 80%;\">("+g+')</span>',a.trustAsHtml(f)}}]).filter('customListFilter',['oiSelectEscape',function(a){function b(b,c,d,e){var f,g,h,i,j=[],k=[],l=[],m=[];if(c){for(c=a(c).toASCII().toLowerCase(),f=0,h=!1;f<b.length;f++){if(h=b[f].title.toASCII().toLowerCase().match(new RegExp(c)),!h&&e&&(e.length||e.fields))for(g=0;g<e.length&&!h;g++)h=String(b[f][e[g]]).toASCII().toLowerCase().match(new RegExp(c));h&&j.push(b[f])}for(f=0;f<j.length;f++)d(j[f]).toASCII().toLowerCase().match(new RegExp('^'+c))?k.push(j[f]):l.push(j[f]);if(i=k.concat(l),e&&(e===!0||e.all)){a:for(f=0;f<b.length;f++){for(g=0;g<i.length;g++)if(b[f]===i[g])continue a;m.push(b[f])}i=i.concat(m)}}else i=[].concat(b);return i}return b}]),angular.module('resipedia').controller('answerEditController',['answer','$scope','$window','$location','$sce','feedbackService','actionService',function(a,b,c,d,e,f,g){console.log('answerEdit controller');var h=this;a.content=e.valueOf(a.content),b.answer=angular.merge({id:0,content:''},a),b.noExternalSource=a.source_author.length<=0,b.answerPost=function(a){h.running=!0;var c=f.selector(a.target);g.perform({action:'resiexchange_answer_edit',data:{answer_id:b.answer.id,content:b.answer.content,source_author:b.answer.source_author,source_license:b.answer.source_license,source_url:b.answer.source_url},scope:b,callback:function(a,b){if(h.running=!1,'object'!=typeof b.result){var e=b.error_message_ids[0],g=e;'missing_'==g.substr(0,8)&&(g='answer_'+g),f.popover(c,g)}else{var i=b.result.question_id;d.path('/question/'+i)}}})}}]),angular.module('resipedia').controller('articleController',['article','$scope','$window','$location','$http','$sce','$timeout','$uibModal','actionService','feedbackService',function(a,b,c,d,e,f,g,h,i,j){console.log('article controller');var k=this;angular.isDefined(a.articles)?(b.term=a,b.article=a.articles[0]):(b.term={id:null,title:a.title,title_url:a.title_url,articles:[a]},b.article=a),b.related_articles=[],e.get('index.php?get=resilexi_article_related&article_id='+b.article.id).then(function(a){
b.related_articles=a.data.result}),k.toURL=function(a){var b=new String(a);return b.toURL()},k.openModal=function(a,b,d,e){return h.open({animation:!0,ariaLabelledBy:'modal-title',ariaDescribedBy:'modal-body',templateUrl:e||'modalCustom.html',controller:['$uibModalInstance',function(c,e){var f=this;f.title_id=a,f.header_id=b,f.body=d,f.ok=function(){c.close()},f.cancel=function(){c.dismiss()}}],controllerAs:'ctrl',size:'md',appendTo:angular.element(c.document.querySelector(".modal-wrapper")),resolve:{items:function(){return k.items}}}).result},b.begin=function(a,c){b.committed=!1,b.previous=angular.merge({},c),a(b),b.committed=!0},b.rollback=function(){angular.isDefined(b.previous)&&'object'==typeof b.previous&&angular.merge(b.term,b.previous)},b.articleComment=function(a,c){var d=j.selector(a.target);i.perform({action:'resilexi_article_comment',data:{article_id:b.term.articles[c].id,content:b.term.articles[c].newCommentContent},scope:b,callback:function(a,b){if('object'!=typeof b.result){var e=b.error_message_ids[0],f=e;j.popover(d,f)}else{var h=b.result.id;a.term.articles[c].comments.push(b.result),a.term.articles[c].newCommentShow=!1,a.term.articles[c].newCommentContent='',g(function(){j.popover('#comment-'+a.term.articles[c].id+'-'+h,'')})}}})},b.articleFlag=function(a,c){var d=function(a){angular.isDefined(a.committed)&&a.committed||(angular.isDefined(a.term.articles[c].history.resilexi_article_flag)||(a.term.articles[c].history.resilexi_article_flag=!1),a.term.articles[c].history.resilexi_article_flag===!0?a.term.articles[c].history.resilexi_article_flag=!1:a.term.articles[c].history.resilexi_article_flag=!0)};b.begin(d,{articles:b.term.articles});var e=j.selector(a.target);i.perform({action:'resilexi_article_flag',data:{article_id:b.term.articles[c].id},scope:b,callback:function(a,b){if(b.result<0){a.rollback();var c=b.error_message_ids[0],f=c;j.popover(e,f)}else d(a)}})},b.articleVoteUp=function(a,c){angular.isDefined(b.term.articles[c].history.resilexi_article_votedown)||(b.term.articles[c].history.resilexi_article_votedown=!1),angular.isDefined(b.term.articles[c].history.resilexi_article_voteup)||(b.term.articles[c].history.resilexi_article_voteup=!1);var d=function(a){angular.isDefined(a.committed)&&a.committed||(a.term.articles[c].history.resilexi_article_voteup===!0?(a.term.articles[c].history.resilexi_article_voteup=!1,a.term.articles[c].score--):(a.term.articles[c].history.resilexi_article_votedown===!0&&(a.term.articles[c].history.resilexi_article_votedown=!1,a.term.articles[c].score++),a.term.articles[c].history.resilexi_article_voteup=!0,a.term.articles[c].score++))};b.begin(d,{articles:b.term.articles});var e=j.selector(a.target);i.perform({action:'resilexi_article_voteup',data:{article_id:b.term.articles[c].id},scope:b,callback:function(a,b){if(b.result>=0)d(a),b.result===!0&&j.popover(e,'ARTICLE_ACTIONS_VOTEUP_OK','info',!0);else{a.rollback();var c=b.error_message_ids[0],f=c;j.popover(e,f)}}})},b.articleVoteDown=function(a,c){angular.isDefined(b.term.articles[c].history.resilexi_article_votedown)||(b.term.articles[c].history.resilexi_article_votedown=!1),angular.isDefined(b.term.articles[c].history.resilexi_article_voteup)||(b.term.articles[c].history.resilexi_article_voteup=!1);var d=function(a){angular.isDefined(a.committed)&&a.committed||(a.term.articles[c].history.resilexi_article_votedown===!0?(a.term.articles[c].history.resilexi_article_votedown=!1,a.term.articles[c].score++):(a.term.articles[c].history.resilexi_article_voteup===!0&&(a.term.articles[c].history.resilexi_article_voteup=!1,a.term.articles[c].score--),a.term.articles[c].history.resilexi_article_votedown=!0,a.term.articles[c].score--))};b.begin(d,{articles:b.term.articles});var e=j.selector(a.target);i.perform({action:'resilexi_article_votedown',data:{article_id:b.term.articles[c].id},scope:b,callback:function(a,b){if(b.result>=0)d(a);else{a.rollback();var c=b.error_message_ids[0],f=c;j.popover(e,f)}}})},b.articleStar=function(a,c){angular.isDefined(b.term.articles[c].history.resilexi_article_star)||(b.term.articles[c].history.resilexi_article_star=!1);var d=function(a){angular.isDefined(a.committed)&&a.committed||(a.term.articles[c].history.resilexi_article_star===!0?(a.term.articles[c].history.resilexi_article_star=!1,a.term.articles[c].count_stars--):(a.term.articles[c].history.resilexi_article_star=!0,a.term.articles[c].count_stars++))};b.begin(d,{articles:b.term.articles});var e=j.selector(a.target);i.perform({action:'resilexi_article_star',data:{article_id:b.term.articles[c].id},scope:b,callback:function(a,b){if(b.result<0){a.rollback();var c=b.error_message_ids[0],f=c;j.popover(e,f)}else d(a)}})},b.articleCommentVoteUp=function(a,c,d){angular.isDefined(b.term.articles[c].comments[d].history.resilexi_articlecomment_voteup)||(b.term.articles[c].comments[d].history.resilexi_articlecomment_voteup=!1);var e=function(a){angular.isDefined(a.committed)&&a.committed||(a.term.articles[c].comments[d].history.resilexi_articlecomment_voteup===!0?(a.term.articles[c].comments[d].history.resilexi_articlecomment_voteup=!1,a.term.articles[c].comments[d].score--):(a.term.articles[c].comments[d].history.resilexi_articlecomment_voteup=!0,a.term.articles[c].comments[d].score++))};b.begin(e,{articles:b.term.articles});var f=j.selector(a.target);i.perform({action:'resilexi_articlecomment_voteup',data:{comment_id:b.term.articles[c].comments[d].id},scope:b,callback:function(a,b){if(b.result<0){a.rollback();var c=b.error_message_ids[0],d=c;j.popover(f,d)}else e(a)}})},b.articleCommentFlag=function(a,c,d){angular.isDefined(b.term.articles[c].comments[d].history.resilexi_articlecomment_flag)||(b.term.articles[c].comments[d].history.resilexi_articlecomment_flag=!1);var e=function(a){angular.isDefined(a.committed)&&a.committed||(a.term.articles[c].comments[d].history.resilexi_articlecomment_flag===!0?a.term.articles[c].comments[d].history.resilexi_articlecomment_flag=!1:a.term.articles[c].comments[d].history.resilexi_articlecomment_flag=!0)};b.begin(e,{articles:b.term.articles});var f=j.selector(a.target);i.perform({action:'resilexi_articlecomment_flag',data:{comment_id:b.term.articles[c].comments[d].id},scope:b,callback:function(a,b){if(b.result<0){a.rollback();var c=b.error_message_ids[0],d=c;j.popover(f,d)}else e(a)}})},b.articleCommentEdit=function(a,c,d){var e=j.selector(a.target);i.perform({action:'resilexi_articlecomment_edit',data:{comment_id:b.term.articles[c].comments[d].id,content:b.term.articles[c].comments[d].content},scope:b,callback:function(a,b){if(b.result<0){a.rollback();var f=b.error_message_ids[0],g=f;j.popover(e,g)}else a.term.articles[c].comments[d].editMode=!1}})},b.articleCommentDelete=function(a,c,d){var e=j.selector(a.target);k.openModal('MODAL_COMMENT_DELETE_TITLE','MODAL_COMMENT_DELETE_HEADER',b.term.articles[c].comments[d].content).then(function(){i.perform({action:'resilexi_articlecomment_delete',data:{comment_id:b.term.articles[c].comments[d].id},scope:b,callback:function(a,b){if(b.result===!0)a.term.articles[c].comments.splice(d,1);else if(b.result===!1);else{var f=b.error_message_ids[0],g=f;j.popover(e,g)}}})})},b.articleDelete=function(a,c){var e=j.selector(a.target);k.openModal('MODAL_ARTICLE_DELETE_TITLE','MODAL_ARTICLE_DELETE_HEADER',b.term.articles[c].title).then(function(){i.perform({action:'resilexi_article_delete',data:{article_id:b.term.articles[c].id},scope:b,callback:function(a,b){if(b.result===!0)d.path('/articles');else if(b.result===!1);else{var c=b.error_message_ids[0],f=c;j.popover(e,f)}}})})},b.showShareModal=function(a){return h.open({animation:!0,ariaLabelledBy:'modal-title',ariaDescribedBy:'modal-body',templateUrl:'articleShareModal.html',controller:['$uibModalInstance',function(c,d){var e=this;e.title_id='Partager',c.article=b.term.articles[a],e.ok=function(){c.close()},e.cancel=function(){c.dismiss()}}],controllerAs:'ctrl',scope:b,size:'md',appendTo:angular.element(c.document.querySelector(".modal-wrapper"))}).result}}]),angular.module('resipedia').controller('articleEditController',['article','$scope','$rootScope','$window','$location','$sce','feedbackService','actionService','$http','$q','$httpParamSerializerJQLike',function(a,b,c,d,e,f,g,h,i,j,k){console.log('articleEdit controller');var l=this;b.alerts=[],l.closeAlert=function(a){b.alerts.splice(a,1)},b.versionPopup={opened:!1},b.versionPopupOpen=function(){b.versionPopup.opened=!0},b.addCategory=function(a){return{id:null,title:a,path:a,parent_id:0,parent_path:''}},b.addTerm=function(a){return{id:null,title:a}},b.loadCategoriesMatches=function(a){return a.length<2?[]:i.get('index.php?get=resiway_category_list&channel='+c.config.channel+'&order=title&'+k({domain:['title','ilike','%'+a+'%']})).then(function(a){var b=a.data;return'object'!=typeof b.result?[]:b.result},function(a){return[]})},b.loadTermsMatches=function(a){return a.length<2?[]:i.get('index.php?get=resilexi_term_list&order=title&'+k({domain:['title','ilike','%'+a+'%']})).then(function(a){var b=a.data;return'object'!=typeof b.result?[]:b.result},function(a){return[]})},a.content=f.valueOf(a.content),b.article=angular.merge({id:0,title:'',content:'',categories:[],source_license:'CC-by-nc-sa'},a),!angular.isDefined(a.term)&&angular.isDefined(a.title)&&(b.article.term={id:null,title:a.title}),b.initial_cats_ids=[],angular.forEach(b.article.categories,function(a,c){b.initial_cats_ids.push('-'+a.id)}),b.$watch('article.categories',function(){b.article.categories_ids=angular.copy(b.initial_cats_ids),angular.forEach(b.article.categories,function(a,c){b.article.categories_ids.push(null==a.id?a.title:'+'+a.id)})}),b.$watch('article.term',function(){angular.isDefined(b.article.term)&&(b.article.title=b.article.term.title)}),b.articlePost=function(a){l.running=!0;var d=g.selector(angular.element(a.target));h.perform({action:'resilexi_article_edit',data:{channel:c.config.channel,id:b.article.id,title:b.article.title,content:b.article.content,categories_ids:b.article.categories_ids,source_author:b.article.source_author,source_url:b.article.source_url,source_license:b.article.source_license},scope:b,callback:function(a,b){if(l.running=!1,'object'!=typeof b.result){var c=b.error_message_ids[0],f=c;'missing_'==f.substr(0,8)&&(f='article_'+f),g.popover(d,f)}else{var h=b.result.id;e.path('/article/'+h)}}})}}]),angular.module('resipedia').controller('articlesController',['articles','$scope','$rootScope','$route','$http','$httpParamSerializerJQLike','$window',function(a,b,c,d,e,f,g){console.log('articles controller');var h=this;angular.merge(h,{articles:{items:a,total:c.search.total,currentPage:1,previousPage:-1,limit:c.search.criteria.limit}}),h.load=function(){h.articles.currentPage!=h.articles.previousPage&&(h.articles.previousPage=h.articles.currentPage,h.articles.items=-1,c.search.criteria.start=(h.articles.currentPage-1)*h.articles.limit,e.get('index.php?get=resilexi_article_list&'+f(c.search.criteria)).then(function(a){var b=a.data;'object'!=typeof b.result&&(h.articles.items=[]),h.articles.items=b.result,g.scrollTo(0,0)},function(a){return[]}))},h.categories=[],angular.forEach(c.search.criteria.domain,function(a,c){'categories_ids'==a[0]&&(b.related_categories=[],'object'!=typeof a[2]&&(a[2]=[a[2]]),h.categories=a[2])}),h.categories.length>0&&(e.get('index.php?get=resiway_category_list&channel='+c.config.channel+'&'+f({domain:['id','in',h.categories]})).then(function(a){var c=a.data;'object'==typeof c.result&&(b.categories=c.result)}),angular.forEach(h.categories,function(a,c){e.get('index.php?get=resiway_category_related-article&category_id='+a).then(function(a){var c=a.data;'object'==typeof c.result&&(b.related_categories=c.result)})})),e.get('index.php?get=resiway_category_list&channel='+c.config.channel+'&limit=15&order=count_articles&sort=desc').then(function(a){var c=a.data;'object'==typeof c.result&&(b.featured_categories=c.result)})}]),angular.module('resipedia').controller('authorController',['author','$scope','$rootScope','$http',function(a,b,c,d){console.log('author controller');b.author=angular.merge({id:0,name:'',description:''},a),d.get('index.php?do=resiway_author_profileview&id='+a.id)}]),angular.module('resipedia').controller('authorEditController',['author','$scope','$rootScope','$window','$location','$sce','feedbackService','actionService','$http','$httpParamSerializerJQLike',function(a,b,c,d,e,f,g,h,i,j){console.log('authorEdit controller');var k=this;a.description=f.valueOf(a.description),b.author=angular.merge({id:0,name:'',description:''},a),b.authorPost=function(a){k.running=!0;var d=g.selector(angular.element(a.target));h.perform({action:'resiway_author_edit',data:{channel:c.config.channel,id:b.author.id,name:b.author.name,url:b.author.url,description:b.author.description},scope:b,callback:function(a,b){if(k.running=!1,'object'!=typeof b.result){var c=b.error_message_ids[0],f=c;'missing_'==f.substr(0,8)&&(f='author_'+f),g.popover(d,f)}else{var h=b.result.id,i=b.result.name_url;e.path('/author/'+h+'/'+i)}}})}}]),angular.module('resipedia').controller('badgesController',['categories','$scope','$http','authenticationService',function(a,b,c,d){console.log('badges controller');b.userBadges=[],b.badgeCategories=a,angular.forEach(a,function(b,c){a[c].groups={},angular.forEach(b.badges,function(b,d){'undefined'==typeof a[c].groups[b.group]&&(a[c].groups[b.group]=[]),a[c].groups[b.group].push(b)})}),d.userId().then(function(a){c.post('index.php?get=resiway_userbadge_list',{domain:['user_id','=',a],start:0,limit:100}).then(function(a){var c=a.data;angular.forEach(c.result,function(a,c){b.userBadges.push(+a.badge_id)})})})}]),angular.module('resipedia').controller('categoriesController',['$scope','$rootScope','$http','actionService','feedbackService',function(a,b,c,d,e){console.log('categories controller');var f=this;f.config={items:[],total:-1,currentPage:1,previousPage:-1,limit:30,domain:[],loading:!0},f.load=function(a){a.currentPage!=a.previousPage&&(a.previousPage=a.currentPage,a.total>0&&(a.loading=!0),c.post('index.php?get=resiway_category_list&channel='+b.config.channel,{domain:a.domain,start:(a.currentPage-1)*a.limit,limit:a.limit,total:a.total}).then(function(b){var c=b.data;a.items=c.result,a.total=c.total,a.loading=!1,angular.forEach(a.items,function(b,c){a.items[c].count_items=parseInt(b.count_questions)+parseInt(b.count_documents)+parseInt(b.count_articles)})},function(){}))},a.begin=function(b,c){a.committed=!1,a.previous=angular.merge({},c),b(a),a.committed=!0},a.rollback=function(){angular.isDefined(a.previous)&&'object'==typeof a.previous&&angular.merge(a.question,a.previous)},a.categoryStar=function(b,c){angular.isDefined(f.config.items[c].history)||(f.config.items[c].history={}),angular.isDefined(f.config.items[c].history.resiway_category_star)||(f.config.items[c].history.resiway_category_star=!1);var g=function(a){angular.isDefined(a.committed)&&a.committed||(f.config.items[c].history.resiway_category_star===!0?(f.config.items[c].history.resiway_category_star=!1,f.config.items[c].count_stars--):(f.config.items[c].history.resiway_category_star=!0,f.config.items[c].count_stars++))};a.begin(g,{history:{resiway_category_star:f.config.items[c].history.resiway_category_star},count_stars:f.config.items[c].count_stars});var h=e.selector(b.target);d.perform({action:'resiway_category_star',data:{category_id:f.config.items[c].id},scope:a,callback:function(a,b){if(b.result<0){a.rollback();var c=b.error_message_ids[0],d=c;e.popover(h,d)}else g(a)}})},f.load(f.config)}]),angular.module('resipedia').controller('categoryController',['category','$scope','$rootScope','$route','$http','$httpParamSerializerJQLike','$window',function(a,b,c,d,e,f,g){console.log('category controller'),b.getClassFromType=function(a){switch(a){case'question':return{'fa-comment-o':!0};case'article':return{'fa-file-text-o':!0};case'document':return{'fa-book':!0}}return{}};var h=this;b.category=angular.merge({id:0,title:'',description:'',parent_id:0,parent:{id:a.parent_id,title:a['parent_id.title'],path:a['parent_id.path']}},a),angular.merge(h,{search:{items:[],criteria:angular.extend({},c.search["default"],{q:'['+b.category.title+']'}),total:b.category.count_items,currentPage:1,previousPage:-1,limit:c.search.criteria.limit}}),h.load=function(){h.search.currentPage!=h.search.previousPage&&(h.search.previousPage=h.search.currentPage,h.search.items=-1,h.search.criteria.start=(h.search.currentPage-1)*h.search.limit,e.get('index.php?get=resiway_search&'+f(h.search.criteria)).then(function(a){var b=a.data;'object'!=typeof b.result&&(h.search.items=[]),h.search.items=b.result,g.scrollTo(0,0)},function(a){return[]}))},h.load(),e.get('index.php?get=resiway_category_related&category_id='+b.category.id).then(function(a){var c=a.data;'object'==typeof c.result&&(b.related_categories=c.result)})}]),angular.module('resipedia').controller('categoryEditController',['category','$scope','$rootScope','$window','$location','feedbackService','actionService','$http','$httpParamSerializerJQLike','Upload',function(a,b,c,d,e,f,g,h,i,j){console.log('categoryEdit controller');b.category=angular.merge({id:0,title:'',description:'',parent_id:0,parent:{id:a.parent_id,title:a['parent_id.title'],path:a['parent_id.path']}},a),b.loadMatches=function(a){return a.length<2?[]:h.get('index.php?get=resiway_category_list&channel='+c.config.channel+'&order=title&'+i({channel:global_config.channel,domain:['title','ilike','%'+a+'%']})).then(function(a){var b=a.data;return'object'!=typeof b.result?[]:b.result},function(a){return[]})},b.$watch('category.parent',function(){b.category.parent_id=b.category.parent.id}),b.categoryPost=function(a){j.upload({url:'index.php?do=resiway_category_edit',method:'POST',data:{channel:c.config.channel,id:b.category.id,title:b.category.title,description:b.category.description,parent_id:b.category.parent_id,thumbnail:b.category.thumbnail}})}}]),angular.module('resipedia').controller('documentController',['document','$scope','$window','$location','$http','$sce','$timeout','$uibModal','actionService','feedbackService',function(a,b,c,d,e,f,g,h,i,j){console.log('document controller');var k=this;b.document=a,b.related_documents=[],e.get('index.php?get=resilib_document_related&document_id='+a.id).then(function(a){b.related_documents=a.data.result}),k.toURL=function(a){var b=new String(a);return b.toURL()},k.openModal=function(a,b,d,e){return h.open({animation:!0,ariaLabelledBy:'modal-title',ariaDescribedBy:'modal-body',templateUrl:e||'modalCustom.html',controller:['$uibModalInstance',function(c,e){var f=this;f.title_id=a,f.header_id=b,f.body=d,f.ok=function(){c.close()},f.cancel=function(){c.dismiss()}}],controllerAs:'ctrl',size:'md',appendTo:angular.element(c.document.querySelector(".modal-wrapper")),resolve:{items:function(){return k.items}}}).result},b.begin=function(a,c){b.committed=!1,b.previous=angular.merge({},c),a(b),b.committed=!0},b.rollback=function(){angular.isDefined(b.previous)&&'object'==typeof b.previous&&angular.merge(b.document,b.previous)},b.documentComment=function(a){var c=j.selector(a.target);i.perform({action:'resilib_document_comment',data:{document_id:b.document.id,content:b.document.newCommentContent},scope:b,callback:function(a,b){if('object'!=typeof b.result){var d=b.error_message_ids[0],e=d;j.popover(c,e)}else{var f=b.result.id;a.document.comments.push(b.result),a.document.newCommentShow=!1,a.document.newCommentContent='',g(function(){j.popover('#comment-'+f,'')})}}})},b.documentFlag=function(a){var c=function(a){angular.isDefined(a.committed)&&a.committed||(angular.isDefined(a.document.history.resilib_document_flag)||(a.document.history.resilib_document_flag=!1),a.document.history.resilib_document_flag===!0?a.document.history.resilib_document_flag=!1:a.document.history.resilib_document_flag=!0)};b.begin(c,{history:{resilib_document_flag:b.document.history.resilib_document_flag}});var d=j.selector(a.target);i.perform({action:'resilib_document_flag',data:{document_id:b.document.id},scope:b,callback:function(a,b){if(b.result<0){a.rollback();var e=b.error_message_ids[0],f=e;j.popover(d,f)}else c(a)}})},b.documentVoteUp=function(a){angular.isDefined(b.document.history.resilib_document_votedown)||(b.document.history.resilib_document_votedown=!1),angular.isDefined(b.document.history.resilib_document_voteup)||(b.document.history.resilib_document_voteup=!1);var c=function(a){angular.isDefined(a.committed)&&a.committed||(a.document.history.resilib_document_voteup===!0?(a.document.history.resilib_document_voteup=!1,a.document.score--):(a.document.history.resilib_document_votedown===!0&&(a.document.history.resilib_document_votedown=!1,a.document.score++),a.document.history.resilib_document_voteup=!0,a.document.score++))};b.begin(c,{history:{resilib_document_votedown:b.document.history.resilib_document_votedown,resilib_document_voteup:b.document.history.resilib_document_voteup},score:b.document.score});var d=j.selector(a.target);i.perform({action:'resilib_document_voteup',data:{document_id:b.document.id},scope:b,callback:function(a,b){if(b.result>=0)c(a),b.result===!0&&j.popover(d,'DOCUMENT_ACTIONS_VOTEUP_OK','info',!0);else{a.rollback();var e=b.error_message_ids[0],f=e;j.popover(d,f)}}})},b.documentVoteDown=function(a){angular.isDefined(b.document.history.resilib_document_votedown)||(b.document.history.resilib_document_votedown=!1),angular.isDefined(b.document.history.resilib_document_voteup)||(b.document.history.resilib_document_voteup=!1);var c=function(a){angular.isDefined(a.committed)&&a.committed||(a.document.history.resilib_document_votedown===!0?(a.document.history.resilib_document_votedown=!1,a.document.score++):(a.document.history.resilib_document_voteup===!0&&(a.document.history.resilib_document_voteup=!1,a.document.score--),a.document.history.resilib_document_votedown=!0,a.document.score--))};b.begin(c,{history:{resilib_document_votedown:b.document.history.resilib_document_votedown,resilib_document_voteup:b.document.history.resilib_document_voteup},score:b.document.score});var d=j.selector(a.target);i.perform({action:'resilib_document_votedown',data:{document_id:b.document.id},scope:b,callback:function(a,b){if(b.result>=0)c(a);else{a.rollback();var e=b.error_message_ids[0],f=e;j.popover(d,f)}}})},b.documentStar=function(a){angular.isDefined(b.document.history.resilib_document_star)||(b.document.history.resilib_document_star=!1);var c=function(a){angular.isDefined(a.committed)&&a.committed||(a.document.history.resilib_document_star===!0?(a.document.history.resilib_document_star=!1,a.document.count_stars--):(a.document.history.resilib_document_star=!0,a.document.count_stars++))};b.begin(c,{history:{resilib_document_star:b.document.history.resilib_document_star},count_stars:b.document.count_stars});var d=j.selector(a.target);i.perform({action:'resilib_document_star',data:{document_id:b.document.id},scope:b,callback:function(a,b){if(b.result<0){a.rollback();var e=b.error_message_ids[0],f=e;j.popover(d,f)}else c(a)}})},b.documentCommentVoteUp=function(a,c){angular.isDefined(b.document.comments[c].history.resilib_documentcomment_voteup)||(b.document.comments[c].history.resilib_documentcomment_voteup=!1);var d=function(a){angular.isDefined(a.committed)&&a.committed||(a.document.comments[c].history.resilib_documentcomment_voteup===!0?(a.document.comments[c].history.resilib_documentcomment_voteup=!1,a.document.comments[c].score--):(a.document.comments[c].history.resilib_documentcomment_voteup=!0,a.document.comments[c].score++))};b.begin(d,{comments:b.document.comments});var e=j.selector(a.target);i.perform({action:'resilib_documentcomment_voteup',data:{comment_id:b.document.comments[c].id},scope:b,callback:function(a,b){if(b.result<0){a.rollback();var c=b.error_message_ids[0],f=c;j.popover(e,f)}else d(a)}})},b.documentCommentFlag=function(a,c){angular.isDefined(b.document.comments[c].history.resilib_documentcomment_flag)||(b.document.comments[c].history.resilib_documentcomment_flag=!1);var d=function(a){angular.isDefined(a.committed)&&a.committed||(a.document.comments[c].history.resilib_documentcomment_flag===!0?a.document.comments[c].history.resilib_documentcomment_flag=!1:a.document.comments[c].history.resilib_documentcomment_flag=!0)};b.begin(d,{comments:b.document.comments});var e=j.selector(a.target);i.perform({action:'resilib_documentcomment_flag',data:{comment_id:b.document.comments[c].id},scope:b,callback:function(a,b){if(b.result<0){a.rollback();var c=b.error_message_ids[0],f=c;j.popover(e,f)}else d(a)}})},b.documentCommentEdit=function(a,c){var d=j.selector(a.target);i.perform({action:'resilib_documentcomment_edit',data:{comment_id:b.document.comments[c].id,content:b.document.comments[c].content},scope:b,callback:function(a,b){if(b.result<0){a.rollback();var e=b.error_message_ids[0],f=e;j.popover(d,f)}else a.document.comments[c].editMode=!1}})},b.documentCommentDelete=function(a,c){var d=j.selector(a.target);k.openModal('MODAL_COMMENT_DELETE_TITLE','MODAL_COMMENT_DELETE_HEADER',b.document.comments[c].content).then(function(){i.perform({action:'resilib_documentcomment_delete',data:{comment_id:b.document.comments[c].id},scope:b,callback:function(a,b){if(b.result===!0)a.document.comments.splice(c,1);else if(b.result===!1);else{var e=b.error_message_ids[0],f=e;j.popover(d,f)}}})})},b.documentDelete=function(a){var c=j.selector(a.target);k.openModal('MODAL_DOCUMENT_DELETE_TITLE','MODAL_DOCUMENT_DELETE_HEADER',b.document.title).then(function(){i.perform({action:'resilib_document_delete',data:{document_id:b.document.id},scope:b,callback:function(a,b){if(b.result===!0)d.path('/documents');else if(b.result===!1);else{var e=b.error_message_ids[0],f=e;j.popover(c,f)}}})})},b.showShareModal=function(){return h.open({animation:!0,ariaLabelledBy:'modal-title',ariaDescribedBy:'modal-body',templateUrl:'documentShareModal.html',controller:['$uibModalInstance',function(a,c){var d=this;d.title_id='Partager',a.document=b.document,d.ok=function(){a.close()},d.cancel=function(){a.dismiss()}}],controllerAs:'ctrl',scope:b,size:'md',appendTo:angular.element(c.document.querySelector(".modal-wrapper"))}).result}}]),angular.module('resipedia').controller('documentEditController',['document','$scope','$rootScope','$window','$location','$sce','$translate','feedbackService','actionService','$http','$q','$httpParamSerializerJQLike','Upload',function(a,b,c,d,e,f,g,h,i,j,k,l,m){console.log('documentEdit controller');var n=this;b.alerts=[],n.closeAlert=function(a){b.alerts.splice(a,1)},b.dateOptions={formatYear:'yy',maxDate:new Date,startingDay:1},b.versionPopup={opened:!1},b.versionPopupOpen=function(){b.versionPopup.opened=!0},b.addCategory=function(a){return{id:null,title:a,path:a,parent_id:0,parent_path:''}},b.addAuthor=function(a){return{id:null,name:a}},b.loadCategoriesMatches=function(a){return a.length<2?[]:j.get('index.php?get=resiway_category_list&channel='+c.config.channel+'&order=title&'+l({domain:['title','ilike','%'+a+'%']})).then(function(a){var b=a.data;return'object'!=typeof b.result?[]:b.result},function(a){return[]})},b.loadAuthorsMatches=function(a){return a.length<2?[]:j.get('index.php?get=resiway_author_list&channel='+c.config.channel+'&order=name&'+l({domain:['name','ilike','%'+a+'%']})).then(function(a){var b=a.data;return'object'!=typeof b.result?[]:b.result},function(a){return[]})},a.description=f.valueOf(a.description),a.last_update=new Date(a.last_update),b.document=angular.merge({id:0,title:'',authors_ids:[{}],last_update:'',description:'',categories_ids:[{}],license:'CC-by-nc-sa',content:{name:a.title},thumbnail:{name:'thumbnail'}},a),b.initial_cats_ids=[],angular.forEach(b.document.categories,function(a,c){b.initial_cats_ids.push('-'+a.id)}),b.initial_authors_ids=[],angular.forEach(b.document.authors,function(a,c){b.initial_authors_ids.push('-'+a.id)}),b.$watch('document.categories',function(){b.document.categories_ids=angular.copy(b.initial_cats_ids),angular.forEach(b.document.categories,function(a,c){b.document.categories_ids.push(null==a.id?a.title:'+'+a.id)})}),b.$watch('document.authors',function(){b.document.authors_ids=angular.copy(b.initial_authors_ids),angular.forEach(b.document.authors,function(a,c){b.document.authors_ids.push(null==a.id?a.name:'+'+a.id)})}),b.documentThumbnailSelected=!1,b.thumbnailChange=function(a,c,d,e,f,g){if(angular.isDefined(d)&&d.length){var h=angular.element(window.document.querySelector('#document-thumbnail'));h.detach(),window.setTimeout(function(){b.documentThumbnailSelected=!0},250)}},b.documentPost=function(a){if('object'!=typeof b.document.last_update||null===b.document.last_update)b.alerts.push({type:'warning',msg:'Il manque la date de publication du document (en cas de doute, une approximation suffit).'});else if(0==b.document.id&&'undefined'==typeof b.document.thumbnail.size)b.alerts.push({type:'warning',msg:'La vignette n\'est pas reconnue: vérifiez le format d\'image (jpeg) et la taille (<1MB).'});else if(0==b.document.id&&'undefined'==typeof b.document.content.size)b.alerts.push({type:'warning',msg:'Le document n\'est pas reconnu: vérifiez le format (pdf) et la taille (<64MB).'});else{var d=h.selector(angular.element(a.target));n.running=!0,m.upload({url:'index.php?do=resilib_document_edit',method:'POST',data:{channel:c.config.channel,id:b.document.id,title:b.document.title,authors_ids:b.document.authors_ids,last_update:b.document.last_update.toJSON(),original_url:b.document.original_url,license:b.document.license,description:b.document.description,pages:b.document.pages,categories_ids:b.document.categories_ids,content:b.document.content,thumbnail:b.document.thumbnail}}).then(function(a){n.running=!1;var b=a.data;if('object'!=typeof b.result){var c=b.error_message_ids[0],f=c;'missing_'==f.substr(0,8)&&(f='document_'+f),h.popover(d,f)}else{var g=b.result.id;e.path('/document/'+g)}},function(a){n.running=!1;var b='';console.log(a),angular.forEach(a.data.errors,function(c,d){console.log(d+': '+c+' ('+a.status+')'),b+=g.instant('MISSING_PARAM'==d?'document_missing_'+c:c)}),h.popover(d,b)},function(a){})}}}]),angular.module('resipedia').controller('documentsController',['documents','$scope','$rootScope','$route','$http','$httpParamSerializerJQLike','$window',function(a,b,c,d,e,f,g){console.log('documents controller');var h=this;angular.merge(h,{documents:{items:a,total:c.search.total,currentPage:1,previousPage:-1,limit:c.search.criteria.limit}}),h.load=function(){h.documents.currentPage!=h.documents.previousPage&&(h.documents.previousPage=h.documents.currentPage,h.documents.items=-1,c.search.criteria.start=(h.documents.currentPage-1)*h.documents.limit,e.get('index.php?get=resilib_document_list&'+f(c.search.criteria)).then(function(a){var b=a.data;'object'!=typeof b.result&&(h.documents.items=[]),h.documents.items=b.result,g.scrollTo(0,0)},function(a){return[]}))},h.categories=[],angular.forEach(c.search.criteria.domain,function(a,c){'categories_ids'==a[0]&&(b.related_categories=[],'object'!=typeof a[2]&&(a[2]=[a[2]]),h.categories=a[2])}),h.categories.length>0&&(e.get('index.php?get=resiway_category_list&channel='+c.config.channel+'&'+f({domain:['id','in',h.categories]})).then(function(a){var c=a.data;'object'==typeof c.result&&(b.categories=c.result)}),angular.forEach(h.categories,function(a,c){e.get('index.php?get=resiway_category_related-document&category_id='+a).then(function(a){var c=a.data;'object'==typeof c.result&&(b.related_categories=c.result)})})),e.get('index.php?get=resiway_category_list&channel='+c.config.channel+'&limit=15&order=count_documents&sort=desc').then(function(a){var c=a.data;'object'==typeof c.result&&(b.featured_categories=c.result)})}]),angular.module('resipedia').controller('emptyController',['$scope',function(a){console.log('empty controller')}]),angular.module('resipedia').controller('helpCategoriesController',['categories','$scope',function(a,b){console.log('helpCategories controller');var c=this;c.categories=a}]),angular.module('resipedia').controller('helpCategoryController',['category','$scope',function(a,b){
console.log('helpCategory controller');var c=this;c.category=a}]),angular.module('resipedia').controller('helpCategoryEditController',['category','$scope','$location','feedbackService','actionService',function(a,b,c,d,e){console.log('helpCategoryEdit controller');var f=this;f.category=angular.extend({title:'',description:''},a),b.categoryPost=function(a){var g=d.selector(a.target);e.perform({action:'resiexchange_helpcategory_edit',data:{category_id:f.category.id,title:f.category.title,description:f.category.description},scope:b,callback:function(a,b){if('object'!=typeof b.result){var e=b.error_message_ids[0],f=e;d.popover(g,f)}else{var h=b.result.id;c.path('/help/category/'+h)}}})}}]),angular.module('resipedia').controller('helpTopicController',['topic','categories','$scope',function(a,b,c){console.log('helpTopic controller');var d=this;d.topic=a,d.categories=b}]),angular.module('resipedia').controller('helpTopicEditController',['topic','categories','$scope','$location','$sce','feedbackService','actionService',function(a,b,c,d,e,f,g){console.log('hepTopicEdit controller');var h=this;a.content=e.valueOf(a.content),h.topic=angular.extend({id:0,title:'',content:'',category_id:0},a),h.categories=b,c.category=null,angular.forEach(h.categories,function(a,b){a.id==h.topic.category_id&&(c.category=a)}),c.$watch('category',function(){h.topic.category_id=c.category.id}),c.topicPost=function(a){var b=f.selector(a.target);g.perform({action:'resiexchange_helptopic_edit',data:{topic_id:h.topic.id,title:h.topic.title,content:h.topic.content,category_id:h.topic.category_id},scope:c,callback:function(a,c){if('object'!=typeof c.result){var e=c.error_message_ids[0],g=e;f.popover(b,g)}else{var h=c.result.id;d.path('/help/topic/'+h)}}})}}]),angular.module('resipedia').controller('homeController',['$http','$scope','$rootScope','$location','authenticationService',function(a,b,c,d,e){console.log('home controller');var f=this;f.active_questions=[],f.poor_questions=[],f.last_documents=[];b.slides=[{},{},{}];b.recent_activity={actions:[]},a.get('index.php?get=resiway_actionlog_recent').then(function(a){a.data;'object'==typeof a.data.result&&(b.recent_activity.actions=a.data.result)},function(){}),a.get('index.php?get=resiway_stats').then(function(a){var b=a.data;'object'==typeof a.data.result&&(f.count_questions=parseInt(b.result['resiexchange.count_questions']),f.count_answers=parseInt(b.result['resiexchange.count_answers']),f.count_comments=parseInt(b.result['resiexchange.count_comments']),f.count_comments+=parseInt(b.result['resilib.count_comments']),f.count_comments+=parseInt(b.result['resilexi.count_comments']),f.count_documents=parseInt(b.result['resilib.count_documents']),f.count_articles=parseInt(b.result['resilib.count_documents']),f.count_posts=f.count_questions+f.count_answers+f.count_articles+f.count_comments+2479,f.count_users=parseInt(b.result['resiway.count_users'])+5560)},function(){}),a.get('index.php?get=resiexchange_question_list&order=modified&limit=15&sort=desc').then(function(a){a.data;'object'==typeof a.data.result&&(f.active_questions=a.data.result)},function(){}),a.get('index.php?get=resiexchange_question_list&order=count_answers&limit=15&sort=asc').then(function(a){a.data;'object'==typeof a.data.result&&(f.poor_questions=a.data.result)},function(){}),a.get('index.php?get=resilib_document_list&order=count_stars&limit=10&sort=desc').then(function(a){a.data;'object'==typeof a.data.result&&(f.last_documents=a.data.result)},function(){}),b.amount="5EUR/mois",b.$watch('amount',function(a){switch(a){case'5EUR/mois':b.amount_dedication="Aidez une famille à savoir comment manger sain et local";break;case'10EUR/mois':b.amount_dedication="Offrez aux agriculteurs les moyens d'absorber du CO2 au lieu d'en émettre trop";break;case'25EUR/mois':b.amount_dedication="Participez à la résilience de l'humain vivant en harmonie avec l'environnement dont il dépend";break;case'25EUR/an':b.amount_dedication="Contribuez à ce que chacun puisse fabriquer ses produits d'entretien écologiques";break;case'50EUR/an':b.amount_dedication="Permettez la diffusion de savoirs ancestraux et de nouvelles technologies écologiques"}})}]),angular.module('resipedia').controller('questionController',['question','$scope','$window','$location','$http','$sce','$timeout','$uibModal','actionService','feedbackService',function(a,b,c,d,e,f,g,h,i,j){console.log('question controller');var k=this;b.question=a,b.related_questions=[],e.get('index.php?get=resiexchange_question_related&limit=7&question_id='+a.id).then(function(a){b.related_questions=a.data.result}),k.openModal=function(a,b,c,d){return h.open({animation:!0,ariaLabelledBy:'modal-title',ariaDescribedBy:'modal-body',templateUrl:d||'modalCustom.html',controller:['$uibModalInstance',function(d,e){var f=this;f.title_id=a,f.header_id=b,f.body=c,f.ok=function(){d.close()},f.cancel=function(){d.dismiss()}}],controllerAs:'ctrl',size:'md',appendTo:angular.element(document.querySelector(".modal-wrapper")),resolve:{items:function(){return k.items}}}).result},b.begin=function(a,c){b.committed=!1,b.previous=angular.merge({},c),a(b),b.committed=!0},b.rollback=function(){angular.isDefined(b.previous)&&'object'==typeof b.previous&&angular.merge(b.question,b.previous)},b.questionComment=function(a){var c=j.selector(a.target);i.perform({action:'resiexchange_question_comment',data:{question_id:b.question.id,content:b.question.newCommentContent},scope:b,callback:function(a,b){if('object'!=typeof b.result){var d=b.error_message_ids[0],e=d;j.popover(c,e)}else{var f=b.result.id;a.question.comments.push(b.result),a.question.newCommentShow=!1,a.question.newCommentContent='',g(function(){j.popover('#comment-'+f,'')})}}})},b.questionFlag=function(a){var c=function(a){angular.isDefined(a.committed)&&a.committed||(angular.isDefined(a.question.history.resiexchange_question_flag)||(a.question.history.resiexchange_question_flag=!1),a.question.history.resiexchange_question_flag===!0?a.question.history.resiexchange_question_flag=!1:a.question.history.resiexchange_question_flag=!0)};b.begin(c,{history:{resiexchange_question_flag:b.question.history.resiexchange_question_flag}});var d=j.selector(a.target);i.perform({action:'resiexchange_question_flag',data:{question_id:b.question.id},scope:b,callback:function(a,b){if(b.result<0){a.rollback();var e=b.error_message_ids[0],f=e;j.popover(d,f)}else c(a)}})},b.questionAnswer=function(a){k.running=!0;var c=j.selector(a.target);i.perform({action:'resiexchange_question_answer',data:{question_id:b.question.id,content:b.question.newAnswerContent,source_author:b.question.newAnswerSource_author,source_url:b.question.newAnswerSource_url,source_license:b.question.newAnswerSource_license},scope:b,callback:function(a,b){if(k.running=!1,'object'!=typeof b.result){var d=b.error_message_ids[0],e=d;j.popover(c,e)}else{var h=b.result.id;b.result.content=f.trustAsHtml(b.result.content),b.result.commentsLimit=5,b.result.newCommentShow=!1,b.result.newCommentContent='',a.question.answers.push(b.result),a.question.history.resiexchange_question_answer=!0,g(function(){j.popover('#answer-'+h,'')})}}})},b.questionVoteUp=function(a){angular.isDefined(b.question.history.resiexchange_question_votedown)||(b.question.history.resiexchange_question_votedown=!1),angular.isDefined(b.question.history.resiexchange_question_voteup)||(b.question.history.resiexchange_question_voteup=!1);var c=function(a){angular.isDefined(a.committed)&&a.committed||(a.question.history.resiexchange_question_voteup===!0?(a.question.history.resiexchange_question_voteup=!1,a.question.score--):(a.question.history.resiexchange_question_votedown===!0&&(a.question.history.resiexchange_question_votedown=!1,a.question.score++),a.question.history.resiexchange_question_voteup=!0,a.question.score++))};b.begin(c,{history:{resiexchange_question_votedown:b.question.history.resiexchange_question_votedown,resiexchange_question_voteup:b.question.history.resiexchange_question_voteup},score:b.question.score});var d=j.selector(a.target);i.perform({action:'resiexchange_question_voteup',data:{question_id:b.question.id},scope:b,callback:function(a,b){if(b.result>=0)c(a),b.result===!0&&j.popover(d,'QUESTION_ACTIONS_VOTEUP_OK','info',!0);else{a.rollback();var e=b.error_message_ids[0],f=e;j.popover(d,f)}}})},b.questionVoteDown=function(a){angular.isDefined(b.question.history.resiexchange_question_votedown)||(b.question.history.resiexchange_question_votedown=!1),angular.isDefined(b.question.history.resiexchange_question_voteup)||(b.question.history.resiexchange_question_voteup=!1);var c=function(a){angular.isDefined(a.committed)&&a.committed||(a.question.history.resiexchange_question_votedown===!0?(a.question.history.resiexchange_question_votedown=!1,a.question.score++):(a.question.history.resiexchange_question_voteup===!0&&(a.question.history.resiexchange_question_voteup=!1,a.question.score--),a.question.history.resiexchange_question_votedown=!0,a.question.score--))};b.begin(c,{history:{resiexchange_question_votedown:b.question.history.resiexchange_question_votedown,resiexchange_question_voteup:b.question.history.resiexchange_question_voteup},score:b.question.score});var d=j.selector(a.target);i.perform({action:'resiexchange_question_votedown',data:{question_id:b.question.id},scope:b,callback:function(a,b){if(b.result>=0)c(a);else{a.rollback();var e=b.error_message_ids[0],f=e;j.popover(d,f)}}})},b.questionStar=function(a){angular.isDefined(b.question.history.resiexchange_question_star)||(b.question.history.resiexchange_question_star=!1);var c=function(a){angular.isDefined(a.committed)&&a.committed||(a.question.history.resiexchange_question_star===!0?(a.question.history.resiexchange_question_star=!1,a.question.count_stars--):(a.question.history.resiexchange_question_star=!0,a.question.count_stars++))};b.begin(c,{history:{resiexchange_question_star:b.question.history.resiexchange_question_star},count_stars:b.question.count_stars});var d=j.selector(a.target);i.perform({action:'resiexchange_question_star',data:{question_id:b.question.id},scope:b,callback:function(a,b){if(b.result<0){a.rollback();var e=b.error_message_ids[0],f=e;j.popover(d,f)}else c(a)}})},b.questionCommentVoteUp=function(a,c){angular.isDefined(b.question.comments[c].history.resiexchange_questioncomment_voteup)||(b.question.comments[c].history.resiexchange_questioncomment_voteup=!1);var d=function(a){angular.isDefined(a.committed)&&a.committed||(a.question.comments[c].history.resiexchange_questioncomment_voteup===!0?(a.question.comments[c].history.resiexchange_questioncomment_voteup=!1,a.question.comments[c].score--):(a.question.comments[c].history.resiexchange_questioncomment_voteup=!0,a.question.comments[c].score++))};b.begin(d,{comments:b.question.comments});var e=j.selector(a.target);i.perform({action:'resiexchange_questioncomment_voteup',data:{comment_id:b.question.comments[c].id},scope:b,callback:function(a,b){if(b.result<0){a.rollback();var c=b.error_message_ids[0],f=c;j.popover(e,f)}else d(a)}})},b.questionCommentFlag=function(a,c){angular.isDefined(b.question.comments[c].history.resiexchange_questioncomment_flag)||(b.question.comments[c].history.resiexchange_questioncomment_flag=!1);var d=function(a){angular.isDefined(a.committed)&&a.committed||(a.question.comments[c].history.resiexchange_questioncomment_flag===!0?a.question.comments[c].history.resiexchange_questioncomment_flag=!1:a.question.comments[c].history.resiexchange_questioncomment_flag=!0)};b.begin(d,{comments:b.question.comments});var e=j.selector(a.target);i.perform({action:'resiexchange_questioncomment_flag',data:{comment_id:b.question.comments[c].id},scope:b,callback:function(a,b){if(b.result<0){a.rollback();var c=b.error_message_ids[0],f=c;j.popover(e,f)}else d(a)}})},b.questionCommentEdit=function(a,c){var d=j.selector(a.target);i.perform({action:'resiexchange_questioncomment_edit',data:{comment_id:b.question.comments[c].id,content:b.question.comments[c].content},scope:b,callback:function(a,b){if(b.result<0){a.rollback();var e=b.error_message_ids[0],f=e;j.popover(d,f)}else a.question.comments[c].editMode=!1}})},b.questionCommentDelete=function(a,c){var d=j.selector(a.target);k.openModal('MODAL_COMMENT_DELETE_TITLE','MODAL_COMMENT_DELETE_HEADER',b.question.comments[c].content).then(function(){i.perform({action:'resiexchange_questioncomment_delete',data:{comment_id:b.question.comments[c].id},scope:b,callback:function(a,b){if(b.result===!0)a.question.comments.splice(c,1);else if(b.result===!1);else{var e=b.error_message_ids[0],f=e;j.popover(d,f)}}})})},b.questionDelete=function(a){var c=j.selector(a.target);k.openModal('MODAL_QUESTION_DELETE_TITLE','MODAL_QUESTION_DELETE_HEADER',b.question.title).then(function(){i.perform({action:'resiexchange_question_delete',data:{question_id:b.question.id},scope:b,callback:function(a,b){if(b.result===!0)d.path('/questions');else if(b.result===!1);else{var e=b.error_message_ids[0],f=e;j.popover(c,f)}}})})},b.answerVoteUp=function(a,c){angular.isDefined(b.question.answers[c].history.resiexchange_answer_votedown)||(b.question.answers[c].history.resiexchange_answer_votedown=!1),angular.isDefined(b.question.answers[c].history.resiexchange_answer_voteup)||(b.question.answers[c].history.resiexchange_answer_voteup=!1);var d=function(a){angular.isDefined(a.committed)&&a.committed||(a.question.answers[c].history.resiexchange_answer_voteup===!0?(a.question.answers[c].history.resiexchange_answer_voteup=!1,a.question.answers[c].score--):(a.question.answers[c].history.resiexchange_answer_votedown===!0&&(a.question.answers[c].history.resiexchange_answer_votedown=!1,a.question.answers[c].score++),a.question.answers[c].history.resiexchange_answer_voteup=!0,a.question.answers[c].score++))};b.begin(d,{answers:b.question.answers});var e=j.selector(a.target);i.perform({action:'resiexchange_answer_voteup',data:{answer_id:b.question.answers[c].id},scope:b,callback:function(a,b){if(b.result>=0)d(a),b.result===!0&&j.popover(e,'QUESTION_ACTIONS_VOTEUP_OK','info',!0);else{a.rollback();var c=b.error_message_ids[0],f=c;j.popover(e,f)}}})},b.answerVoteDown=function(a,c){angular.isDefined(b.question.answers[c].history.resiexchange_answer_votedown)||(b.question.answers[c].history.resiexchange_answer_votedown=!1),angular.isDefined(b.question.answers[c].history.resiexchange_answer_voteup)||(b.question.answers[c].history.resiexchange_answer_voteup=!1);var d=function(a){angular.isDefined(a.committed)&&a.committed||(a.question.answers[c].history.resiexchange_answer_votedown===!0?(a.question.answers[c].history.resiexchange_answer_votedown=!1,a.question.answers[c].score++):(a.question.answers[c].history.resiexchange_answer_voteup===!0&&(a.question.answers[c].history.resiexchange_answer_voteup=!1,a.question.answers[c].score--),a.question.answers[c].history.resiexchange_answer_votedown=!0,a.question.answers[c].score--))};b.begin(d,{answers:b.question.answers});var e=j.selector(a.target);i.perform({action:'resiexchange_answer_votedown',data:{answer_id:b.question.answers[c].id},scope:b,callback:function(a,b){if(b.result>=0)d(a);else{a.rollback();var c=b.error_message_ids[0],f=c;j.popover(e,f)}}})},b.answerFlag=function(a,c){angular.isDefined(b.question.answers[c].history.resiexchange_answer_flag)||(b.question.answers[c].history.resiexchange_answer_flag=!1);var d=function(a){angular.isDefined(a.committed)&&a.committed||(a.question.answers[c].history.resiexchange_answer_flag===!0?a.question.answers[c].history.resiexchange_answer_flag=!1:a.question.answers[c].history.resiexchange_answer_flag=!0)};b.begin(d,{answers:b.question.answers});var e=j.selector(a.target);i.perform({action:'resiexchange_answer_flag',data:{answer_id:b.question.answers[c].id},scope:b,callback:function(a,b){if(b.result<0){a.rollback();var c=b.error_message_ids[0],f=c;j.popover(e,f)}else d(a)}})},b.answerComment=function(a,c){var d=j.selector(a.target);i.perform({action:'resiexchange_answer_comment',data:{answer_id:b.question.answers[c].id,content:b.question.answers[c].newCommentContent},scope:b,callback:function(a,b){if('object'!=typeof b.result){var e=b.error_message_ids[0],f=e;j.popover(d,f)}else{var h=a.question.answers[c].id,i=b.result.id;a.question.answers[c].comments.push(b.result),a.question.answers[c].newCommentShow=!1,a.question.answers[c].newCommentContent='',g(function(){j.popover('#comment-'+h+'-'+i,'')})}}})},b.answerCommentVoteUp=function(a,c,d){angular.isDefined(b.question.answers[c].comments[d].history.resiexchange_answercomment_voteup)||(b.question.answers[c].comments[d].history.resiexchange_answercomment_voteup=!1);var e=function(a){angular.isDefined(a.committed)&&a.committed||(a.question.answers[c].comments[d].history.resiexchange_answercomment_voteup===!0?(a.question.answers[c].comments[d].history.resiexchange_answercomment_voteup=!1,a.question.answers[c].comments[d].score--):(a.question.answers[c].comments[d].history.resiexchange_answercomment_voteup=!0,a.question.answers[c].comments[d].score++))};b.begin(e,{answers:b.question.answers});var f=j.selector(a.target);i.perform({action:'resiexchange_answercomment_voteup',data:{comment_id:b.question.answers[c].comments[d].id},scope:b,callback:function(a,b){if(b.result<0){a.rollback();var c=b.error_message_ids[0],d=c;j.popover(f,d)}else e(a)}})},b.answerCommentFlag=function(a,c,d){angular.isDefined(b.question.answers[c].comments[d].history.resiexchange_answercomment_flag)||(b.question.answers[c].comments[d].history.resiexchange_answercomment_flag=!1);var e=function(a){angular.isDefined(a.committed)&&a.committed||(a.question.answers[c].comments[d].history.resiexchange_answercomment_flag===!0?a.question.answers[c].comments[d].history.resiexchange_answercomment_flag=!1:a.question.answers[c].comments[d].history.resiexchange_answercomment_flag=!0)};b.begin(e,{answers:b.question.answers});var f=j.selector(a.target);i.perform({action:'resiexchange_answercomment_flag',data:{comment_id:b.question.answers[c].comments[d].id},scope:b,callback:function(a,b){if(b.result<0){a.rollback();var c=b.error_message_ids[0],d=c;j.popover(f,d)}else e(a)}})},b.answerCommentEdit=function(a,c,d){var e=j.selector(a.target);i.perform({action:'resiexchange_answercomment_edit',data:{comment_id:b.question.answers[c].comments[d].id,content:b.question.answers[c].comments[d].content},scope:b,callback:function(a,b){if(b.result<0){a.rollback();var f=b.error_message_ids[0],g=f;j.popover(e,g)}else a.question.answers[c].comments[d].editMode=!1}})},b.answerCommentDelete=function(a,c,d){var e=j.selector(a.target);k.openModal('MODAL_COMMENT_DELETE_TITLE','MODAL_COMMENT_DELETE_HEADER',b.question.answers[c].comments[d].content).then(function(){i.perform({action:'resiexchange_answercomment_delete',data:{comment_id:b.question.answers[c].comments[d].id},scope:b,callback:function(a,b){if(b.result===!0)a.question.answers[c].comments.splice(d,1);else if(b.result===!1);else{var f=b.error_message_ids[0],g=f;j.popover(e,g)}}})})},b.answerDelete=function(a,c){var d=j.selector(a.target);k.openModal('MODAL_ANSWER_DELETE_TITLE','MODAL_ANSWER_DELETE_HEADER',b.question.answers[c].content_excerpt).then(function(){i.perform({action:'resiexchange_answer_delete',data:{answer_id:b.question.answers[c].id},scope:b,callback:function(a,b){if(b.result===!0)a.question.answers.splice(c,1),a.question.history.resiexchange_question_answer=!1;else if(b.result===!1);else{var e=b.error_message_ids[0],f=e;j.popover(d,f)}}})})},b.answerConvert=function(a,c){var d=j.selector(a.target);k.openModal('MODAL_ANSWER_CONVERT_TITLE','MODAL_ANSWER_CONVERT_HEADER',b.question.answers[c].content_excerpt).then(function(){i.perform({action:'resiexchange_answer_convert',data:{answer_id:b.question.answers[c].id},scope:b,callback:function(a,b){if('object'!=typeof b.result){var e=b.error_message_ids[0],f=e;j.popover(d,f)}else{var h=b.result.id;a.question.answers.splice(c,1),a.question.history.resiexchange_question_answer=!1,a.question.comments.push(b.result),g(function(){j.popover('#comment-'+h,'')})}}})})},b.showShareModal=function(){return h.open({animation:!0,ariaLabelledBy:'modal-title',ariaDescribedBy:'modal-body',templateUrl:'questionShareModal.html',controller:['$uibModalInstance',function(a,c){var d=this;d.title_id='Partager',a.question=b.question,d.ok=function(){a.close()},d.cancel=function(){a.dismiss()}}],controllerAs:'ctrl',scope:b,size:'md',appendTo:angular.element(document.querySelector(".modal-wrapper"))}).result}}]),angular.module('resipedia').controller('questionEditController',['question','$scope','$rootScope','$window','$location','$sce','feedbackService','actionService','$http','$httpParamSerializerJQLike',function(a,b,c,d,e,f,g,h,i,j){console.log('questionEdit controller');var k=this;b.addItem=function(a){return{id:null,title:a,path:a,parent_id:0,parent_path:''}},b.loadMatches=function(a){return a.length<2?[]:i.get('index.php?get=resiway_category_list&channel='+c.config.channel+'&order=title&'+j({domain:['title','ilike','%'+a+'%']})).then(function(a){var b=a.data;return'object'!=typeof b.result?[]:b.result},function(a){return[]})},a.content=f.valueOf(a.content),b.question=angular.merge({id:0,title:'',content:'',tags_ids:[{}]},a),b.question.tags={},angular.merge(b.question.tags,a.categories),b.initial_tags_ids=[],angular.forEach(b.question.tags,function(a,c){b.initial_tags_ids.push('-'+a.id)}),b.$watch('question.tags',function(){b.question.tags_ids=angular.copy(b.initial_tags_ids),angular.forEach(b.question.tags,function(a,c){b.question.tags_ids.push(null==a.id?a.title:'+'+a.id)})}),b.questionPost=function(a){k.running=!0;var d=g.selector(angular.element(a.target));h.perform({action:'resiexchange_question_edit',data:{channel:c.config.channel,question_id:b.question.id,title:b.question.title,content:b.question.content,tags_ids:b.question.tags_ids},scope:b,callback:function(a,b){if(k.running=!1,'object'!=typeof b.result){var c=b.error_message_ids[0],f=c;'missing_'==f.substr(0,8)&&(f='question_'+f),g.popover(d,f)}else{var h=b.result.id;e.path('/question/'+h)}}})}}]),angular.module('resipedia').controller('questionsController',['questions','$scope','$rootScope','$route','$http','$httpParamSerializerJQLike','$window',function(a,b,c,d,e,f,g){console.log('questions controller');var h=this;angular.merge(h,{questions:{items:a,total:c.search.total,currentPage:1,previousPage:-1,limit:c.search.criteria.limit}}),h.load=function(){h.questions.currentPage!=h.questions.previousPage&&(h.questions.previousPage=h.questions.currentPage,h.questions.items=-1,c.search.criteria.start=(h.questions.currentPage-1)*h.questions.limit,e.get('index.php?get=resiexchange_question_list&channel='+c.config.channel+'&'+f(c.search.criteria)).then(function(a){var b=a.data;'object'!=typeof b.result&&(h.questions.items=[]),h.questions.items=b.result,g.scrollTo(0,0)},function(a){return[]}))},h.categories=[],angular.forEach(c.search.criteria.domain,function(a,c){'categories_ids'==a[0]&&(b.related_categories=[],'object'!=typeof a[2]&&(a[2]=[a[2]]),h.categories=a[2])}),h.categories.length>0?(e.get('index.php?get=resiway_category_list&channel='+c.config.channel+'&'+f({domain:['id','in',h.categories]})).then(function(a){var c=a.data;'object'==typeof c.result&&(b.categories=c.result)}),angular.forEach(h.categories,function(a,c){e.get('index.php?get=resiway_category_related-question&category_id='+a).then(function(a){var c=a.data;'object'==typeof c.result&&(b.related_categories=c.result)})})):e.get('index.php?get=resiexchange_question_list&channel='+c.config.channel+'&limit=15&order=modified&sort=desc').then(function(a){var c=a.data;'object'==typeof c.result&&(b.active_questions=c.result)}),e.get('index.php?get=resiway_category_list&channel='+c.config.channel+'&limit=15&order=count_questions&sort=desc').then(function(a){var c=a.data;'object'==typeof c.result&&(b.featured_categories=c.result)})}]),angular.module('resipedia').controller('searchController',['search','$scope','$rootScope','$route','$http','$httpParamSerializerJQLike','$window',function(a,b,c,d,e,f,g){console.log('search controller'),b.getClassFromType=function(a){switch(a){case'question':return{'fa-comment-o':!0};case'article':return{'fa-file-text-o':!0};case'document':return{'fa-book':!0}}return{}};var h=this;angular.merge(h,{search:{items:a,total:c.search.total,currentPage:1,previousPage:-1,limit:c.search.criteria.limit}}),h.load=function(a){arguments.length&&'object'==typeof a&&(angular.extend(c.search.criteria,a),angular.merge(h,{search:{currentPage:1,previousPage:-1}})),h.search.currentPage!=h.search.previousPage&&(h.search.previousPage=h.search.currentPage,h.search.items=-1,c.search.criteria.start=(h.search.currentPage-1)*h.search.limit,e.get('index.php?get=resiway_search&'+f(c.search.criteria)).then(function(a){var b=a.data;'object'!=typeof b.result&&(h.search.items=[]),h.search.items=b.result,g.scrollTo(0,0)},function(a){return[]}))},angular.isDefined(c.category)&&e.get('index.php?get=resiway_category_related&category_id='+c.category.id).then(function(a){var c=a.data;'object'==typeof c.result&&(b.related_categories=c.result)})}]),angular.module('resipedia').controller('topBarCtrl',['$scope','$rootScope','$document','$http','actionService','authenticationService',function(a,b,c,d,e,f){function g(){i.platformDropdown=!1,i.userDropdown=!1,i.notifyDropdown=!1,i.helpDropdown=!1}function h(b){if(b)for(var d=angular.element(b.target).scope();d;){if(a.$id==d.$id)return!1;d=d.$parent}a.$apply(function(){g(),c.off('click',h)})}console.log('topbar controller');var i=this;i.platformDropdown=!1,i.userDropdown=!1,i.notifyDropdown=!1,i.helpDropdown=!1,angular.element(document.querySelectorAll('#topBar a')).on('click',function(){g()}),a.togglePlatformDropdown=function(){var a=i.platformDropdown;g(),a?c.off('click',h):c.on('click',h),i.platformDropdown=!a},a.toggleUserDropdown=function(){var a=i.userDropdown;g(),a?c.off('click',h):c.on('click',h),i.userDropdown=!a},a.toggleNotifyDropdown=function(){var a=i.notifyDropdown;g(),a?c.off('click',h):c.on('click',h),i.notifyDropdown=!a},a.toggleHelpDropdown=function(){var a=i.helpDropdown;g(),a?c.off('click',h):c.on('click',h),i.helpDropdown=!a},i.signOut=function(){e.perform({action:'resiway_user_signout',next_path:'/',callback:function(a,b){f.signout()}})},i.notificationsDismissAll=function(){b.user.notifications=[],d.get('index.php?do=resiway_notification_dismiss-all')}}]),angular.module('resipedia').controller('userConfirmController',['$scope','$rootScope','$routeParams','$http','authenticationService',function(a,b,c,d,e){console.log('userConfirm controller');var f=this;f.code=c.code,f.verified=!1,f.password_updated=!1,f.closeAlerts=function(){a.alerts=[]},a.password='',a.confirm='',a.alerts=[],d.get('index.php?do=resiway_user_confirm&code='+f.code).then(function(a){var c=a.data;'undefined'!=typeof a.data.result&&a.data.result===!0&&(f.verified=c.result,'undefined'!=typeof c.notifications&&c.notifications.length>0&&(b.user.notifications=b.user.notifications.concat(c.notifications)),e.authenticate())},function(){}),f.passwordReset=function(){a.alerts=[],0==a.password.length||a.password!=a.confirm?0==a.password.length?a.alerts.push({type:'warning',msg:'Please, provide a new password.'}):0==a.confirm.length?a.alerts.push({type:'warning',msg:'Please, re-type your new password.'}):a.password!=a.confirm&&a.alerts.push({type:'warning',msg:'Confirmation does not match the specified password.'}):d.get('index.php?do=resiway_user_passwordreset&password='+md5(a.password)+'&confirm='+md5(a.confirm)).then(function(a){var b=a.data;'undefined'!=typeof a.data.result&&a.data.result===!0&&(f.password_updated=b.result)},function(){})}}]),angular.module('resipedia').controller('userEditController',['user','$scope','$window','$filter','$http','$translate','feedbackService','actionService','hello',function(a,b,c,d,e,f,g,h,i){console.log('userEdit controller');var j=this;if(j.user=a,console.log(j.user),0==Object.keys(a).length)return void console.log('empty object');if(j.publicity_mode={id:1,text:'Fullname'},j.delays=[{delay:0,label:'notification immédiate'},{delay:1,label:'un jour (max 1 email par jour)'},{delay:7,label:'une semaine (max 1 email par semaine)'},{delay:30,label:'un mois (max 1 email par mois)'}],j.modes=[{id:1,text:'Fullname'},{id:2,text:'Firstname + Lastname inital'},{id:3,text:'Firstname only'}],f(['USER_EDIT_PUBLICITY_MODE_FULLNAME','USER_EDIT_PUBLICITY_MODE_FIRSTNAME_L','USER_EDIT_PUBLICITY_MODE_FIRSTNAME']).then(function(a){j.modes[0].text=a.USER_EDIT_PUBLICITY_MODE_FULLNAME,j.modes[1].text=a.USER_EDIT_PUBLICITY_MODE_FIRSTNAME_L,j.modes[2].text=a.USER_EDIT_PUBLICITY_MODE_FIRSTNAME}).then(function(){angular.forEach(j.modes,function(a){a.id==j.user.publicity_mode&&(j.publicity_mode={id:a.id,text:a.text})})}),j.avatars={},'undefined'!=typeof j.user.login){j.avatars={libravatar:'https://seccdn.libravatar.org/avatar/'+md5(j.user.login)+'?s=@size',gravatar:'https://www.gravatar.com/avatar/'+md5(j.user.login)+'?s=@size',identicon:'https://www.gravatar.com/avatar/'+md5(j.user.firstname+j.user.id)+'?d=identicon&s=@size'};var k=function(a){var b=(new Date).getTime()/1e3;return a&&a.access_token&&a.expires>b},l=i('facebook'),m=i('google');k(l.getAuthResponse())&&l.api('me').then(function(a){b.$apply(function(){j.avatars.facebook=a.thumbnail})}),k(m.getAuthResponse())&&m.api('me').then(function(a){b.$apply(function(){var b=a.thumbnail;j.avatars.google=b.replace(/\?sz=.*/,"?sz=@size")})})}b.$watchGroup([function(){return j.publicity_mode},function(){return j.user.firstname},function(){return j.user.lastname}],function(){switch(j.user.publicity_mode=j.publicity_mode.id,j.user.publicity_mode){case 1:j.user.display_name=j.user.firstname+' '+j.user.lastname;break;case 2:var a='';j.user.lastname.length&&(a=j.user.lastname.substr(0,1)+'.'),j.user.display_name=j.user.firstname+' '+a;break;case 3:j.user.display_name=j.user.firstname}}),j.userPost=function(a){j.running=!0;var d=g.selector(angular.element(a.target));h.perform({action:'resiway_user_edit',data:{id:j.user.id,firstname:j.user.firstname,lastname:j.user.lastname,publicity_mode:j.user.publicity_mode,language:j.user.language,country:j.user.country,location:j.user.location,about:j.user.about,avatar_url:j.user.avatar_url,notify_reputation_update:j.user.notify_reputation_update,notify_badge_awarded:j.user.notify_badge_awarded,notify_question_comment:j.user.notify_question_comment,notify_answer_comment:j.user.notify_answer_comment,notify_question_answer:j.user.notify_question_answer,notify_updates:j.user.notify_updates,notice_delay:j.user.notice_delay},scope:b,callback:function(a,b){if(j.running=!1,'object'!=typeof b.result){var e=b.error_message_ids[0],f=e;g.popover(d,f)}else c.scrollTo(0,0),a.showMessage=!0}})}}]),angular.module('resipedia').controller('userNotificationsController',['$scope','$rootScope','actionService','feedbackService',function(a,b,c,d){console.log('userNotifications controller');var e=this;e.dismiss=function(e,f){var g=d.selector(e.target);c.perform({action:'resiway_notification_dismiss',data:{notification_id:b.user.notifications[f].id},scope:a,callback:function(a,c){if(c.result===!0)b.user.notifications.splice(f,1);else{var e=c.error_message_ids[0],h=e;d.popover(g,h)}}})}}]),angular.module('resipedia').controller('userPasswordController',['$scope','$routeParams','$http','authenticationService',function(a,b,c,d){console.log('userPassword controller');var e=this;if(a.password='',a.confirm='',a.alerts=[],e.code=b.code,e.password_updated=!1,e.closeAlerts=function(){a.alerts=[]},'undefined'!=typeof e.code){var f=String(e.code).replace(/-/g,'_').replace(/\+/g,'/').base64_decode();if(f.indexOf(';')>0){var g=f.split(';');c.get('index.php?do=resiway_user_signin&login='+g[0]+'&password='+g[1]).then(function(a){var b=a.data;'undefined'!=typeof a.data.result&&a.data.result>0&&(e.verified=b.result,d.authenticate())},function(){})}}e.passwordReset=function(){a.alerts=[],0==a.password.length||a.password!=a.confirm?0==a.password.length?a.alerts.push({type:'warning',msg:'Please, provide a new password.'
}):0==a.confirm.length?a.alerts.push({type:'warning',msg:'Please, re-type your new password.'}):a.password!=a.confirm&&a.alerts.push({type:'warning',msg:'Confirmation does not match the specified password.'}):c.get('index.php?do=resiway_user_passwordreset&password='+md5(a.password)+'&confirm='+md5(a.confirm)).then(function(a){var b=a.data;'undefined'!=typeof a.data.result&&a.data.result===!0&&(e.password_updated=b.result)},function(){})}}]),angular.module('resipedia').controller('userProfileController',['user','$scope','$http',function(a,b,c){console.log('userProfile controller');var d=this;d.user=a,c.get('index.php?do=resiway_user_profileview&id='+a.id),d.load=function(a){a.currentPage!=a.previousPage&&(a.previousPage=a.currentPage,a.items=-1,c.post('index.php?get='+a.provider,{domain:a.domain,start:(a.currentPage-1)*a.limit,limit:a.limit,total:a.total}).then(function(b){var c=b.data;a.items=c.result,a.total=c.total},function(){}))},angular.merge(d,{updates:{items:-1,total:-1,currentPage:1,previousPage:-1,limit:5,domain:[[['user_id','=',d.user.id],['user_increment','<>',0]],[['author_id','=',d.user.id],['author_increment','<>',0]]],provider:'resiway_actionlog_list'},badges:{items:-1,total:-1,currentPage:1,previousPage:-1,limit:5,domain:['user_id','=',d.user.id],provider:'resiway_userbadge_list'},questions:{items:-1,total:-1,currentPage:1,previousPage:-1,limit:5,domain:['creator','=',d.user.id],provider:'resiexchange_question_list'},answers:{items:-1,total:-1,currentPage:1,previousPage:-1,limit:5,domain:['creator','=',d.user.id],provider:'resiexchange_answer_list'},favorites:{items:-1,total:-1,currentPage:1,previousPage:-1,limit:5,domain:['user_id','=',d.user.id],provider:'resiway_userfavorite_list'},actions:{items:-1,total:-1,currentPage:1,previousPage:-1,limit:5,domain:['user_id','=',d.user.id],provider:'resiway_actionlog_list'}}),b.removeFavorite=function(a,b){c.post('index.php?do=resiway_userfavorite_delete&userfavorite_id='+d.favorites.items[b].id),d.favorites.items.splice(b,1)}}]),angular.module('resipedia').controller('userSignController',['$scope','$rootScope','$location','$routeParams','$http','authenticationService',function(a,b,c,d,e,f){console.log('userSign controller');var g=this;switch(g.mode='in',d.mode){case'recover':case'in':case'up':g.mode=d.mode}a.remember=!0,a.accept=!1,a.username='',a.password='',a.firstname='',a.email='',a.signInAlerts=[],a.signUpAlerts=[],a.recoverAlerts=[],g.recovery_sent=!1,g.closeSignInAlerts=function(){a.signInAlerts=[]},g.closeSignInAlert=function(b){a.signInAlerts.splice(b,1)},g.closeSignUpAlerts=function(){a.signUpAlerts=[]},g.closeSignUpAlert=function(b){a.signUpAlerts.splice(b,1)},g.closeRecoverAlerts=function(){a.recoverAlerts=[]},g.closeRecoverAlert=function(b){a.recoverAlerts.splice(b,1)},g.signIn=function(){0==a.username.length||0==a.password.length?0==a.username.length?a.signInAlerts.push({type:'warning',msg:'Please, provide your email as identifier.'}):0==a.password.length&&a.signInAlerts.push({type:'warning',msg:'Please, provide your password.'}):(g.running=!0,g.closeSignInAlerts(),f.signin(a.username,md5(a.password)).then(function(a){g.running=!1,c.path(b.pendingAction&&'undefined'!=typeof b.pendingAction.next_path?b.pendingAction.next_path:b.previousPath)},function(){g.running=!1,a.signInAlerts=[{type:'danger',msg:'Email ou mot de passe incorrect.'}]}))},g.signUp=function(){0==a.username.length||0==a.firstname.length?0==a.firstname.length?a.signUpAlerts.push({type:'warning',msg:'Oups, il manque votre prénom.'}):0==a.username.length&&a.signUpAlerts.push({type:'warning',msg:'Il faut aussi un email comme identifiant.'}):a.accept?(g.running=!0,g.closeSignUpAlerts(),f.register(a.username,a.firstname).then(function(d){g.running=!1,f.authenticate().then(function(a){e.get('index.php?do=resiway_user_pull'),c.path(b.pendingAction&&'undefined'!=typeof b.pendingAction.next_path?b.pendingAction.next_path:b.previousPath)},function(b){a.signUpAlerts=[{type:'danger',msg:'Sorry, an unexpected error occured.'}]})},function(b){g.running=!1;var c=b.error_message_ids[0];a.signUpAlerts=[{type:'danger',msg:c}]})):a.signUpAlerts.push({type:'warning',msg:'Pour pouvoir participer il est nécessaire d\'accepter les conditions d\'utilisation.'})},g.recover=function(){0==a.email.length?a.recoverAlerts.push({type:'warning',msg:'Please, provide your email.'}):(g.running=!0,g.closeRecoverAlerts(),e.get('index.php?do=resiway_user_passwordrecover&email='+a.email).then(function(a){g.running=!1;var b=a.data;'undefined'!=typeof a.data.result&&a.data.result===!0&&(g.recovery_sent=b.result)},function(){g.running=!1;var b=data.error_message_ids[0];a.recoverAlerts=[{type:'danger',msg:b}]}))},a.$on('auth.signed',function(a,d){g.running=!1,console.log('auth notification received in userSign controller'),c.path(b.pendingAction&&'undefined'!=typeof b.pendingAction.next_path?b.pendingAction.next_path:b.previousPath)})}]),angular.module('resipedia').controller('usersController',['users','$scope','$rootScope','$http',function(a,b,c,d){console.log('users controller');var e=this;e.config={items:a,total:-1,currentPage:1,previousPage:-1,limit:30,domain:[],loading:!1},e.load=function(a){a.currentPage!=a.previousPage&&(a.previousPage=a.currentPage,a.total>0&&(a.loading=!0),d.post('index.php?get=resiway_user_list&order=reputation',{domain:a.domain,start:(a.currentPage-1)*a.limit,limit:a.limit,total:a.total}).then(function(b){var c=b.data;a.items=c.result,a.total=c.total,a.loading=!1},function(){}))},e.load(e.config)}]);