'use strict';String.prototype.toASCII=function(){for(var a,b=this.toLocaleLowerCase(),c='',d={192:'A',193:'A',194:'A',195:'A',196:'A',197:'A',224:'a',225:'a',226:'a',227:'a',228:'a',229:'a',200:'E',201:'E',202:'E',203:'E',232:'e',233:'e',234:'e',235:'e',204:'I',205:'I',206:'I',207:'I',236:'i',237:'i',238:'i',239:'i',210:'O',211:'O',212:'O',213:'O',214:'O',216:'O',240:'o',242:'o',243:'o',244:'o',245:'o',246:'o',217:'U',218:'U',219:'U',220:'U',249:'u',250:'u',251:'u',252:'u'},e=0;e<b.length;e++)a=b.charCodeAt(e),128>a?c+=b.charAt(e):'undefined'!=typeof d[a]&&(c+=d[a]);return c},function(){var a='=',b=[-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,62,-1,-1,-1,63,52,53,54,55,56,57,58,59,60,61,-1,-1,-1,0,-1,-1,-1,0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,-1,-1,-1,-1,-1,-1,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,-1,-1,-1,-1,-1],c='ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_'.split('');String.prototype.base64_decode=function(){for(var c='',d=this,e=0,f=0,g=0;g<d.length;g+=1){var h=d.charCodeAt(g),i=b[127&h];if(10!=h&&13!=h){if(-1===i)return null;f=f<<6|i,e+=6,e>=8&&(e-=8,a!==d.charAt(g)&&(c+=String.fromCharCode(f>>e&255)),f&=(1<<e)-1)}}return e?null:c},String.prototype.base64_encode=function(){var b,d,e,f='',g=this;if(g.length<3)return null;for(b=0,d=g.length-2;d>b;b+=3){var h=g.charCodeAt(b),i=g.charCodeAt(b+1),j=g.charCodeAt(b+2);f+=c[h>>2],f+=c[((3&h)<<4)+(i>>4)],f+=c[((15&i)<<2)+(j>>6)],f+=c[63&j]}if(e=g.length%3,0!==e){b=g.length-e,f+=c[g[b+0]>>2];var h=g.charCodeAt(b),i=g.charCodeAt(b+1);2===e?(f+=c[((3&h)<<4)+(i>>4)],f+=c[(15&i)<<2],f+=a):(f+=c[(3&h)<<4],f+=a+a)}return f}}();var resiway=angular.module('resiexchange',['ngRoute','ngSanitize','ngCookies','ngAnimate','ui.bootstrap','oi.select','textAngular','pascalprecht.translate','angularMoment']).config(['$provide',function(a){a.decorator('taOptions',['taRegisterTool','$delegate',function(a,b){return a('fullScreen',{tooltiptext:'Toogle full screen',iconclass:"fa fa-arrows-alt",activeState:function(){return this.$editor().fullScreen},action:function(){'undefined'==typeof this.$editor().fullScreen&&(this.$editor().fullScreen=!1);var a=this.$editor().displayElements.text.parent().parent(),b=angular.element(document.querySelector('body')),c=angular.element(a.children()[0]);this.$editor().fullScreen?(a.css({position:this.$editor().original_position,width:this.$editor().original_width,height:this.$editor().original_height}),b.append(this.$editor().original_body_content),this.$editor().original_parent.append(a.detach())):(this.$editor().original_width=a.css('width'),this.$editor().original_height=a.css('height'),this.$editor().original_parent=a.parent(),this.$editor().original_position=a.css('position'),this.$editor().original_body_content=b.children().detach(),b.append(a.detach().css({position:'absolute',width:'100%',height:'100%','z-index':'9999',top:'0px',left:'0px'}))),a.css('height','calc(100% - '+c[0].offsetHeight+'px)'),this.$editor().fullScreen=!this.$editor().fullScreen}}),b.toolbar[1].push('fullScreen'),b}])}]).config(function(){moment.updateLocale(global_config.locale,{calendar:{sameElse:'LLL'}})}).config(['$translateProvider',function(a){'undefined'!=typeof translations&&a.translations(global_config.locale,translations).preferredLanguage(global_config.locale).useSanitizeValueStrategy('sanitize')}]).config(['$httpProvider','$httpParamSerializerJQLikeProvider',function(a,b){a.defaults.headers.post['Content-Type']='application/x-www-form-urlencoded;charset=utf-8',a.defaults.paramSerializer='$httpParamSerializerJQLike',a.defaults.transformRequest.unshift(b.$get())}]).config(['$locationProvider',function(a){a.html5Mode(!1)}]).run(['$window','$timeout','$rootScope','$location','authenticationService','actionService','feedbackService',function(a,b,c,d,e,f,g){console.log('run method invoked'),c.popover=g;const h='/user/sign';c.viewContentLoading=!0,c.pendingAction=null,c.previousPath='/',c.currentPath=null,c.search={criteria:{domain:[],order:'title',sort:'desc',start:0,limit:25},total:0},c.user={id:0},c.$on('$locationChangeStart',function(a){c.viewContentLoading=!0}),c.$on('$locationChangeSuccess',function(a){console.log('$locationChangeSuccess'),c.currentPath&&(c.previousPath=c.currentPath),c.currentPath=d.path(),console.log('previous path: '+c.previousPath),console.log('current path: '+c.currentPath)}),c.$on('$viewContentLoaded',function(e){console.log('$viewContentLoaded received'),c.viewContentLoading=!1,b(function(){if(d.hash().length){console.log('scroll to element');var b=angular.element(document.querySelector('#'+d.hash()));a.scrollTo(0,b[0].offsetTop-55)}else console.log('scroll to top'),a.scrollTo(0,0);0==c.user.id&&c.previousPath.substring(0,h.length)==h&&c.currentPath.substring(0,h.length)!=h&&(console.log('pending action disgarded'),c.pendingAction=null),c.pendingAction&&c.currentPath.substring(0,h.length)!=h&&(console.log('continuing ation'),console.log(c.pendingAction),c.pendingAction.scope=e.targetScope,f.perform(c.pendingAction))})}),e.authenticate()}]).controller('rootController',['$rootScope','$scope',function(a,b){console.log('root controller');var c=this;c.makeLink=function(a,b){switch(a){case'resiexchange\\Question':return'#/question/'+b;case'resiway\\Category':return'#/category/'+b}},c.avatarURL=function(a,b){var c=new String(a);return c.replace("@size",b)},c.humanReadable={date:function(a){var b='',c=Date.parse(a);if(NaN!=c){var d=new Date(c);b=d.toLocaleString('fr',{weekday:'long',year:'numeric',month:'short',day:'numeric'})}return b},datetime:function(a){var b='',c=Date.parse(a);if(NaN!=c){var d=new Date(c);b=d.toLocaleString('fr',{weekday:'long',year:'numeric',month:'short',day:'numeric',hour:'numeric',minute:'numeric'})}return b},dateInterval:function(a){var b='',c=new Date,d=Date.parse(a);if(NaN!=d){var e=new Date(d),f=Math.floor((c-e)/864e5);if(0==f)return'today';if(7>f)return 1==f?'yesterday':f+" days ago";if(30>f){var g=Math.floor(f/7);return 1==g?'last week':g+" weeks ago"}if(365>f){var h=Math.floor(f/30);return 1==h?'last month':h+" months ago"}var i=Math.floor(f/365);return 1==i?'last year':i+" years ago"}return b},timeElapsed:function(a){var b='',c=new Date,d=Date.parse(a);if(NaN!=d){var e=new Date(d),f=Math.floor((c-e)/864e5);if(0==f)return'today';if(7>f)return f+" days";if(30>f){var g=Math.floor(f/7);return g+" weeks"}if(365>f){var h=Math.floor(f/30);return h+" months"}var i=Math.floor(f/365);return i+" years"}return b},number:function(a){if('undefined'==typeof a||'number'!=typeof parseInt(a))return 0;if(0==a)return 0;var b=a/Math.abs(a);a=Math.abs(a);var c=['','k','M','G'],d=Math.floor(Math.log(a)/Math.log(1e3));return b*(0>=d?a:(a/Math.pow(1e3,d)).toFixed(1))+c[d]}}}]).controller('homeController',['$http','$rootScope','$location',function(a,b,c){var d=this;console.log('home controller'),a.get('index.php?get=resiexchange_stats').then(function(a){var b=a.data;'object'==typeof a.data.result&&(d.count_questions=b.result['resiexchange.count_questions'],d.count_answers=b.result['resiexchange.count_answers'],d.count_comments=b.result['resiexchange.count_comments'])},function(){}),d.search=function(a){b.search.criteria.domain=['title','like','%'+a+'%'],'/questions'==c.path()?$route.reload():c.path('/questions')}}]);angular.module('resiexchange').service('routeObjectProvider',['$http','$route','$q',function(a,b,c){return{provide:function(d){var e=c.defer();return e.resolve({}),'undefined'==typeof b.current.params.id||0==b.current.params.id?e.promise:a.get('index.php?get='+d+'&id='+b.current.params.id).then(function(a){var b=a.data;return'object'!=typeof b.result?{}:b.result},function(a){return e.promise})}}}]).service('routeCategoryProvider',['routeObjectProvider',function(a){this.load=function(){return a.provide('resiway_category')}}]).service('routeCategoriesProvider',['$http',function(a){this.load=function(){return a.get('index.php?get=resiway_category_list&order=title').then(function(a){var b=a.data;return'object'!=typeof b.result?[]:b.result},function(a){return[]})}}]).service('routeQuestionsProvider',['$http','$rootScope','$httpParamSerializerJQLike',function(a,b,c){this.load=function(){return a.get('index.php?get=resiexchange_question_list&'+c(b.search.criteria)).then(function(a){var c=a.data;return'object'!=typeof c.result?(b.search.total=0,[]):(b.search.total=c.total,c.result)},function(a){return[]})}}]).service('routeQuestionProvider',['routeObjectProvider','$sce',function(a,b){this.load=function(){return a.provide('resiexchange_question').then(function(a){var c={commentsLimit:5,newCommentShow:!1,newCommentContent:'',newAnswerContent:''};return angular.extend(a,c),a.content=b.trustAsHtml(a.content),angular.forEach(a.answers,function(d,e){a.answers[e].content=b.trustAsHtml(a.answers[e].content),angular.extend(a.answers[e],c)}),a})}}]).service('routeAnswerProvider',['routeObjectProvider','$sce',function(a,b){this.load=function(){return a.provide('resiexchange_answer').then(function(a){return a.content=b.trustAsHtml(a.content),a})}}]).service('routeUserProvider',['routeObjectProvider',function(a){this.load=function(){return a.provide('resiway_user')}}]).service('routeHelpTopicProvider',['routeObjectProvider','$sce',function(a,b){this.load=function(){return a.provide('resiexchange_help_topic').then(function(a){return a.content=b.trustAsHtml(a.content),a})}}]).service('routeHelpCategoryProvider',['routeObjectProvider',function(a){this.load=function(){return a.provide('resiexchange_help_category')}}]).service('routeHelpCategoriesProvider',['routeObjectProvider','$http',function(a,b){this.load=function(){return b.get('index.php?get=resiexchange_help_category_list&order=title').then(function(a){var b=a.data;return'object'!=typeof b.result?[]:b.result},function(a){return[]})}}]).service('routeBadgesProvider',['routeObjectProvider','$http',function(a,b){this.load=function(){return b.get('index.php?get=resiway_badge_list&order=name').then(function(a){var b=a.data;return'object'!=typeof b.result?[]:b.result},function(a){return[]})}}]).service('authenticationService',['$rootScope','$http','$q','$cookies',function(a,b,c,d){var e=this;e.username='',e.password='',this.userId=function(){var a=c.defer();return b.get('index.php?get=resiway_user_id').then(function(b){'undefined'!=typeof b.data.result&&b.data.result>0?a.resolve(b.data.result):a.reject()},function(b){a.reject()}),a.promise},this.userData=function(a){var d=c.defer();return b.get('index.php?get=resiway_user&id='+a).success(function(b,c,e,f){'object'==typeof b&&'object'==typeof b.result&&b.result.id==a?d.resolve(b.result):d.reject()}).error(function(a,b,c,e){d.reject()}),d.promise},this.setCredentials=function(a,b,c){if(e.username=a,e.password=b,c){var f=new Date,g=new Date(f.getFullYear()+1,f.getMonth(),f.getDate());d.put('username',a,{expires:g}),d.put('password',b,{expires:g})}},this.clearCredentials=function(){console.log('clearing credentials'),e.username='',e.password='',a.user={id:0},d.remove('username'),d.remove('password')},this.signin=function(){var a=c.defer();return'undefined'!=typeof e.username&&'undefined'!=typeof e.password&&e.username.length&&e.password.length?b.get('index.php?do=resiway_user_signin&login='+e.username+'&password='+e.password).then(function(b){return'undefined'==typeof b.data.result?a.reject({result:-1}):b.data.result<0?a.reject(b.data):a.resolve(b.data.result)},function(b){return a.reject({result:-1})}):(e.clearCredentials(),a.reject({result:-2})),a.promise},this.register=function(a,d){var e=c.defer();return b.get('index.php?do=resiway_user_signup&login='+a+'&firstname='+d).then(function(a){return a.data.result<0?e.reject(a.data):e.resolve(a.data.result)},function(a){return e.reject({result:-1})}),e.promise},this.authenticate=function(){var b=c.defer();return a.user.id>0?b.resolve(a.user):e.userId().then(function(c){e.userData(c).then(function(c){a.user=c,b.resolve(c)},function(a){b.reject(a)})},function(){e.signin().then(function(c){e.userData(c).then(function(c){a.user=c,b.resolve(c)},function(a){b.reject(a)})},function(a){b.reject(a)})}),b.promise}}]).service('actionService',['$rootScope','$http','$location','authenticationService',function(a,b,c,d){this.perform=function(e){var f={action:'',data:'',next_path:c.path(),scope:null,callback:function(a,b){}},g=angular.extend({},f,e);d.authenticate().then(function(){a.pendingAction=null,'undefined'!=typeof g.action&&g.action.length>0&&b.post('index.php?do='+g.action,g.data).then(function(b){'undefined'!=typeof b.data.notifications&&b.data.notifications.length>0&&(a.user.notifications=a.user.notifications.concat(b.data.notifications)),'function'==typeof g.callback&&g.callback(g.scope,b.data)},function(){})},function(){a.pendingAction=g,c.hash(''),c.path('/user/sign')})}}]).service('feedbackService',['$window',function(a){function b(){d.elem&&(d.elem.triggerHandler('toggle-popover'),d.elem=null)}function c(a){for(var b=angular.element(a),c=angular.element(document.body);('undefined'==typeof b.attr('id')||'undefined'==typeof b.attr('uib-popover-template'))&&(b=b.parent(),b!=c););return'#'+b.attr('id')}var d={content:'',elem:null,classname:null,id:null};return{content:function(){return d.content},classname:function(){var a=document.querySelector('#'+d.id);if(a&&'undefined'!=typeof a){var b=angular.element(a);b.parent().parent().parent().addClass(d.classname)}return d.classname},id:function(){return d.id},popover:function(c,e,f){b();var g=angular.element(document.querySelector(c));d.content=e,d.elem=g,d.id='popover-'+g.attr('id'),d.classname='popover-'+(f||'danger');var h=g[0].offsetTop;(h<a.pageYOffset||h>a.pageYOffset+a.innerHeight)&&a.scrollTo(0,h-a.innerHeight/4),e.length>0&&g.triggerHandler('toggle-popover')},close:function(){b()},selector:function(a){return b(),c(a)}}}]),angular.module('resiexchange').config(['$routeProvider','$routeParamsProvider','$httpProvider',function(a,b,c){var d='packages/resiexchange/apps/views/';a.when('/help/categories',{templateUrl:d+'helpCategories.html',controller:'helpCategoriesController as ctrl',resolve:{categories:['routeHelpCategoriesProvider',function(a){return a.load()}]}}).when('/help/category/edit/:id',{templateUrl:d+'helpCategoryEdit.html',controller:'helpCategoryEditController as ctrl',resolve:{category:['routeHelpCategoryProvider',function(a){return a.load()}]}}).when('/help/category/:id/:title?',{templateUrl:d+'helpCategory.html',controller:'helpCategoryController as ctrl',resolve:{category:['routeHelpCategoryProvider',function(a){return a.load()}]}}).when('/help/topic/edit/:id',{templateUrl:d+'helpTopicEdit.html',controller:'helpTopicEditController as ctrl',resolve:{topic:['routeHelpTopicProvider',function(a){return a.load()}],categories:['routeHelpCategoriesProvider',function(a){return a.load()}]}}).when('/help/topic/:id/:title?',{templateUrl:d+'helpTopic.html',controller:'helpTopicController as ctrl',resolve:{topic:['routeHelpTopicProvider',function(a){return a.load()}],categories:['routeHelpCategoriesProvider',function(a){return a.load()}]}}).when('/badges',{templateUrl:d+'badges.html',controller:'badgesController as ctrl',resolve:{badges:['routeBadgesProvider',function(a){return a.load()}]}}).when('/categories',{templateUrl:d+'categories.html',controller:'categoriesController as ctrl',resolve:{categories:['routeCategoriesProvider',function(a){return a.load()}]}}).when('/category/edit/:id',{templateUrl:d+'categoryEdit.html',controller:'categoryEditController as ctrl',resolve:{category:['routeCategoryProvider',function(a){return a.load()}],categories:['routeCategoriesProvider',function(a){return a.load()}]}}).when('/category/:id',{templateUrl:d+'category.html',controller:'categoryController as ctrl',resolve:{category:['routeCategoryProvider',function(a){return a.load()}]}}).when('/questions',{templateUrl:d+'questions.html',controller:'questionsController as ctrl',resolve:{questions:['routeQuestionsProvider',function(a){return a.load()}]}}).when('/question/edit/:id',{templateUrl:d+'questionEdit.html',controller:'questionEditController as ctrl',resolve:{question:['routeQuestionProvider',function(a){return a.load()}],categories:['routeCategoriesProvider',function(a){return a.load()}]}}).when('/question/:id/:title?',{templateUrl:d+'question.html',controller:'questionController as ctrl',resolve:{question:['routeQuestionProvider',function(a){return a.load()}]}}).when('/answer/edit/:id',{templateUrl:d+'answerEdit.html',controller:'answerEditController as ctrl',resolve:{answer:['routeAnswerProvider',function(a){return a.load()}]}}).when('/user/current/edit',{templateUrl:d+'userEdit.html',controller:['$location','authenticationService',function(a,b){b.userId().then(function(b){a.path('/user/edit/'+b)})}]}).when('/user/edit/:id',{templateUrl:d+'userEdit.html',controller:'userEditController as ctrl',resolve:{user:['routeUserProvider',function(a){return a.load()}]}}).when('/user/profile/:id/:name?',{templateUrl:d+'userProfile.html',controller:'userProfileController as ctrl',resolve:{user:['routeUserProvider',function(a){return a.load()}]}}).when('/user/password/:code?',{templateUrl:d+'userPassword.html',controller:'userPasswordController as ctrl'}).when('/user/confirm/:code',{templateUrl:d+'userConfirm.html',controller:'userConfirmController as ctrl'}).when('/user/notifications/:id',{templateUrl:d+'userNotifications.html',controller:'userNotificationsController as ctrl'}).when('/user/sign/:mode?',{templateUrl:d+'userSign.html',controller:'userSignController as ctrl',reloadOnSearch:!1}).otherwise({templateUrl:d+'home.html',controller:'homeController as ctrl'})}]),angular.module('resiexchange').filter("nl2br",function(){return function(a){return a?a.replace(/\n\r?/g,'<br />'):a}}).filter('size',function(){return function(a,b){return a=a||'',a.replace(new RegExp('<size>','gi'),b)}}).filter("humanizeCount",function(){return function(a,b){if(b)return a.toString().replace(/\B(?=(\d{3})+(?!\d))/g,".");if('undefined'==typeof a||'number'!=typeof parseInt(a))return 0;if(0==a)return 0;var c=a/Math.abs(a);a=Math.abs(a);var d=['','k','M','G'],e=Math.floor(Math.log(a)/Math.log(1e3));return c*(0>=e?a:(a/Math.pow(1e3,e)).toFixed(1))+d[e]}}).filter('customSearchFilter',['$sce',function(a){return function(b,c,d,e,f){var g='<span class="close select-search-list-item_selection-remove">Ã—</span>';return a.trustAsHtml(d.title+g)}}]).filter('customDropdownFilter',['$sce','oiSelectEscape',function(a,b){return function(c,d,e){var f,c=new String(e.title),g=new String(e.path);return d.length>0||angular.isNumber(d)?(d=b(d),f=c.replace(new RegExp(d,'gi'),'<strong>$&</strong>')+' <span style="color: grey; font-style: italic; font-size: 80%;">('+g.replace(new RegExp(d,'gi'),'<strong>$&</strong>')+')</span>'):f=c+" <span style=\"color: grey; font-style: italic; font-size: 80%;\">("+g+')</span>',a.trustAsHtml(f)}}]).filter('customListFilter',['oiSelectEscape',function(a){function b(b,c,d,e){var f,g,h,i,j=[],k=[],l=[],m=[];if(c){for(c=a(c).toASCII().toLowerCase(),f=0,h=!1;f<b.length;f++){if(h=d(b[f]).toASCII().toLowerCase().match(new RegExp(c)),!h&&e&&(e.length||e.fields))for(g=0;g<e.length&&!h;g++)h=String(b[f][e[g]]).toASCII().toLowerCase().match(new RegExp(c));h&&j.push(b[f])}for(f=0;f<j.length;f++)d(j[f]).toASCII().toLowerCase().match(new RegExp('^'+c))?k.push(j[f]):l.push(j[f]);if(i=k.concat(l),e&&(e===!0||e.all)){a:for(f=0;f<b.length;f++){for(g=0;g<i.length;g++)if(b[f]===i[g])continue a;m.push(b[f])}i=i.concat(m)}}else i=[].concat(b);return i}return b}]),angular.module('resiexchange').controller('answerEditController',['answer','$scope','$window','$location','$sce','feedbackService','actionService','textAngularManager',function(a,b,c,d,e,f,g,h){console.log('answerEdit controller');b.answer=a,b.answerPost=function(a){var c=f.selector(a.target);g.perform({action:'resiexchange_answer_edit',data:{answer_id:b.answer.id,content:b.answer.content},scope:b,callback:function(a,b){if('object'!=typeof b.result){var e=b.error_message_ids[0],g=e;'missing_'==g.substr(0,8)&&(g='answer_'+g),f.popover(c,g)}else{var h=b.result.question_id;d.path('/question/'+h)}}})}}]),angular.module('resiexchange').controller('badgesController',['badges','$scope',function(a,b){console.log('badges controller');b.badges=a}]),angular.module('resiexchange').controller('categoriesController',['categories','$scope',function(a,b){console.log('categories controller');b.categories=a}]),angular.module('resiexchange').controller('categoryEditController',['category','categories','$scope','$window','$location','feedbackService','actionService',function(a,b,c,d,e,f,g){console.log('categoryEdit controller');c.category=a,c.categories=b,angular.forEach(b,function(a,b){a.id==c.category.parent_id&&(c.category.parent=a)}),c.$watch('category.parent',function(){c.category.parent_id=c.category.parent.id}),c.categoryPost=function(a){var b=f.selector(angular.element(a.target));g.perform({action:'resiway_category_edit',data:{category_id:c.category.id,title:c.category.title,description:c.category.description,parent_id:c.category.parent_id},scope:c,callback:function(a,c){if('object'!=typeof c.result){var d=c.error_message_ids[0],g=d;'missing_'==g.substr(0,8)&&(g='category_'+g),f.popover(b,g)}else e.path('/categories')}})}}]),angular.module('resiexchange').controller('helpCategoriesController',['categories','$scope',function(a,b){console.log('helpCategories controller');var c=this;c.categories=a}]),angular.module('resiexchange').controller('helpCategoryController',['category','$scope',function(a,b){console.log('helpCategory controller');var c=this;c.category=a}]),angular.module('resiexchange').controller('helpCategoryEditController',['category','$scope','$location','feedbackService','actionService',function(a,b,c,d,e){console.log('helpCategoryEdit controller');var f=this;f.category=angular.extend({title:'',description:''},a),b.categoryPost=function(a){var g=d.selector(a.target);e.perform({action:'resiexchange_helpcategory_edit',data:{category_id:f.category.id,title:f.category.title,description:f.category.description},scope:b,callback:function(a,b){if('object'!=typeof b.result){var e=b.error_message_ids[0],f=e;d.popover(g,f)}else{var h=b.result.id;c.path('/help/category/'+h)}}})}}]),angular.module('resiexchange').controller('helpTopicController',['topic','categories','$scope',function(a,b,c){console.log('helpTopic controller');var d=this;d.topic=a,d.categories=b}]),angular.module('resiexchange').controller('helpTopicEditController',['topic','categories','$scope','$location','$sce','feedbackService','actionService',function(a,b,c,d,e,f,g){console.log('hepTopicEdit controller');var h=this;a.content=e.valueOf(a.content),h.topic=angular.extend({id:0,title:'',content:'',category_id:0},a),h.categories=b,c.category=null,angular.forEach(h.categories,function(a,b){a.id==h.topic.category_id&&(c.category=a)}),c.$watch('category',function(){h.topic.category_id=c.category.id}),c.topicPost=function(a){var b=f.selector(a.target);g.perform({action:'resiexchange_helptopic_edit',data:{topic_id:h.topic.id,title:h.topic.title,content:h.topic.content,category_id:h.topic.category_id},scope:c,callback:function(a,c){if('object'!=typeof c.result){var e=c.error_message_ids[0],g=e;f.popover(b,g)}else{var h=c.result.id;d.path('/help/topic/'+h)}}})}}]),angular.module('resiexchange').controller('questionController',['question','$scope','$window','$location','$sce','$timeout','$uibModal','actionService','feedbackService','textAngularManager',function(a,b,c,d,e,f,g,h,i,j){console.log('question controller');var k=this;b.question=a,k.open=function(a,b,c){return g.open({animation:!0,ariaLabelledBy:'modal-title',ariaDescribedBy:'modal-body',templateUrl:'modalCustom.html',controller:['$uibModalInstance',function(d,e){var f=this;f.title_id=a,f.header_id=b,f.body=c,f.ok=function(){d.close()},f.cancel=function(){d.dismiss()}}],controllerAs:'ctrl',size:'md',appendTo:angular.element(document.querySelector(".modal-wrapper")),resolve:{items:function(){return k.items}}}).result},b.questionComment=function(a){var c=i.selector(a.target);h.perform({action:'resiexchange_question_comment',data:{question_id:b.question.id,content:b.question.newCommentContent},scope:b,callback:function(a,b){if('object'!=typeof b.result){var d=b.error_message_ids[0],e=d;i.popover(c,e)}else{var g=b.result.id;a.question.comments.push(b.result),a.question.newCommentShow=!1,a.question.newCommentContent='',f(function(){i.popover('#comment-'+g,'')})}}})},b.questionFlag=function(a){var c=i.selector(a.target);h.perform({action:'resiexchange_question_flag',data:{question_id:b.question.id},scope:b,callback:function(a,b){if(b.result<0){var d=b.error_message_ids[0],e=d;i.popover(c,e)}else a.question.history.resiexchange_question_flag=b.result}})},b.questionAnswer=function(a){var c=i.selector(a.target);h.perform({action:'resiexchange_question_answer',data:{question_id:b.question.id,content:b.question.newAnswerContent},scope:b,callback:function(a,b){if('object'!=typeof b.result){var d=b.error_message_ids[0],g=d;i.popover(c,g)}else{var h=b.result.id;b.result.content=e.trustAsHtml(b.result.content),b.result.commentsLimit=5,b.result.newCommentShow=!1,b.result.newCommentContent='',a.question.answers.push(b.result),a.question.history.resiexchange_question_answer=!0,f(function(){i.popover('#answer-'+h,'')})}}})},b.questionVoteUp=function(a){var c=i.selector(a.target);h.perform({action:'resiexchange_question_voteup',data:{question_id:b.question.id},scope:b,callback:function(a,b){if(b.result===!0)a.question.history.resiexchange_question_voteup=!0,a.question.score++;else if(b.result===!1)a.question.history.resiexchange_question_votedown=!1,a.question.score++;else{var d=b.error_message_ids[0],e=d;i.popover(c,e)}}})},b.questionVoteDown=function(a){var c=i.selector(a.target);h.perform({action:'resiexchange_question_votedown',data:{question_id:b.question.id},scope:b,callback:function(a,b){if(b.result===!0)a.question.history.resiexchange_question_votedown=!0,a.question.score--;else if(b.result===!1)a.question.history.resiexchange_question_voteup=!1,a.question.score--;else{var d=b.error_message_ids[0],e=d;i.popover(c,e)}}})},b.questionStar=function(a){var c=i.selector(a.target);h.perform({action:'resiexchange_question_star',data:{question_id:b.question.id},scope:b,callback:function(a,b){if(b.result<0){var d=b.error_message_ids[0],e=d;i.popover(c,e)}else a.question.history.resiexchange_question_star=b.result,b.result===!0?a.question.count_stars++:a.question.count_stars--}})},b.questionCommentVoteUp=function(a,c){var d=i.selector(a.target);h.perform({action:'resiexchange_questioncomment_voteup',data:{comment_id:b.question.comments[c].id},scope:b,callback:function(a,b){if(b.result<0){var e=b.error_message_ids[0],f=e;i.popover(d,f)}else a.question.comments[c].history.resiexchange_questioncomment_voteup=b.result,b.result===!0?a.question.comments[c].score++:a.question.comments[c].score--}})},b.questionDelete=function(a){var c=i.selector(a.target);k.open('MODAL_QUESTION_DELETE_TITLE','MODAL_QUESTION_DELETE_HEADER',b.question.title).then(function(){h.perform({action:'resiexchange_question_delete',data:{question_id:b.question.id},scope:b,callback:function(a,b){if(b.result===!0)d.path('/questions');else if(b.result===!1);else{var e=b.error_message_ids[0],f=e;i.popover(c,f)}}})},function(){})},b.answerVoteUp=function(a,c){var d=i.selector(a.target);h.perform({action:'resiexchange_answer_voteup',data:{answer_id:b.question.answers[c].id},scope:b,callback:function(a,b){if(b.result===!0)a.question.answers[c].history.resiexchange_answer_voteup=!0,a.question.answers[c].score++;else if(b.result===!1)a.question.answers[c].history.resiexchange_answer_votedown=!1,a.question.answers[c].score++;else{var e=b.error_message_ids[0],f=e;i.popover(d,f)}}})},b.answerVoteDown=function(a,c){var d=i.selector(a.target);h.perform({action:'resiexchange_answer_votedown',data:{answer_id:b.question.answers[c].id},scope:b,callback:function(a,b){if(b.result===!0)a.question.answers[c].history.resiexchange_answer_votedown=!0,a.question.answers[c].score--;else if(b.result===!1)a.question.answers[c].history.resiexchange_answer_voteup=!1,a.question.answers[c].score--;else{var e=b.error_message_ids[0],f=e;i.popover(d,f)}}})},b.answerFlag=function(a,c){var d=i.selector(a.target);h.perform({action:'resiexchange_answer_flag',data:{answer_id:b.question.answers[c].id},scope:b,callback:function(a,b){if(b.result<0){var e=b.error_message_ids[0],f=e;i.popover(d,f)}else a.question.answers[c].history.resiexchange_answer_flag=b.result}})},b.answerComment=function(a,c){var d=i.selector(a.target);h.perform({action:'resiexchange_answer_comment',data:{answer_id:b.question.answers[c].id,content:b.question.answers[c].newCommentContent},scope:b,callback:function(a,b){if('object'!=typeof b.result){var e=b.error_message_ids[0],g=e;i.popover(d,g)}else{var h=a.question.answers[c].id,j=b.result.id;a.question.answers[c].comments.push(b.result),a.question.answers[c].newCommentShow=!1,a.question.answers[c].newCommentContent='',f(function(){i.popover('#comment-'+h+'-'+j,'')})}}})},b.answerCommentVoteUp=function(a,c,d){var e=i.selector(a.target);h.perform({action:'resiexchange_answercomment_voteup',data:{comment_id:b.question.answers[c].comments[d].id},scope:b,callback:function(a,b){if(b.result<0){var f=b.error_message_ids[0],g=f;i.popover(e,g)}else a.question.answers[c].comments[d].history.resiexchange_answercomment_voteup=b.result,b.result===!0?a.question.answers[c].comments[d].score++:a.question.answers[c].comments[d].score--}})},b.answerCommentFlag=function(a,c,d){var e=i.selector(a.target);h.perform({action:'resiexchange_answercomment_flag',data:{comment_id:b.question.answers[c].comments[d].id},scope:b,callback:function(a,b){if(b.result<0){var f=b.error_message_ids[0],g=f;i.popover(e,g)}else a.question.answers[c].comments[d].history.resiexchange_answercomment_flag=b.result}})},b.answerDelete=function(a,c){var d=i.selector(a.target);k.open('MODAL_ANSWER_DELETE_TITLE','MODAL_ANSWER_DELETE_HEADER',b.question.answers[c].content_excerpt).then(function(){h.perform({action:'resiexchange_answer_delete',data:{answer_id:b.question.answers[c].id},scope:b,callback:function(a,b){if(b.result===!0)a.question.answers.splice(c,1),a.question.history.resiexchange_question_answer=!1;else if(b.result===!1);else{var e=b.error_message_ids[0],f=e;i.popover(d,f)}}})},function(){})}}]),angular.module('resiexchange').controller('questionEditController',['question','categories','$scope','$window','$location','$sce','feedbackService','actionService','textAngularManager',function(a,b,c,d,e,f,g,h,i){console.log('questionEdit controller');c.categories=b,a.content=f.valueOf(a.content),c.question=angular.merge({id:0,title:'',content:'',tags_ids:[{}]},a),c.initial_tags_ids=[],angular.forEach(c.question.tags,function(a,b){c.initial_tags_ids.push('-'+a.id)}),c.$watch('question.tags',function(){c.question.tags_ids=angular.copy(c.initial_tags_ids),angular.forEach(c.question.tags,function(a,b){c.question.tags_ids.push('+'+a.id)})}),c.questionPost=function(a){var b=g.selector(angular.element(a.target));h.perform({action:'resiexchange_question_edit',data:{question_id:c.question.id,title:c.question.title,content:c.question.content,tags_ids:c.question.tags_ids},scope:c,callback:function(a,c){if('object'!=typeof c.result){var d=c.error_message_ids[0],f=d;'missing_'==f.substr(0,8)&&(f='question_'+f),g.popover(b,f)}else{var h=c.result.id;e.path('/question/'+h)}}})}}]),angular.module('resiexchange').controller('questionsController',['questions','$scope','$rootScope','$route','$http',function(a,b,c,d,e){console.log('questions controller');var f=this;f.questions=a,b.doSearch=function(a){angular.extend(c.search.criteria,a),d.reload()}}]),angular.module('resiexchange').controller('topBarCtrl',['$scope','$rootScope','$document','$route','$location','actionService','authenticationService',function(a,b,c,d,e,f,g){
function h(){j.platformDropdown=!1,j.userDropdown=!1,j.notifyDropdown=!1,j.helpDropdown=!1}function i(b){if(b)for(var d=angular.element(b.target).scope();d;){if(a.$id==d.$id)return!1;d=d.$parent}a.$apply(function(){h(),c.off('click',i)})}console.log('topbar controller');var j=this;j.platformDropdown=!1,j.userDropdown=!1,j.notifyDropdown=!1,j.helpDropdown=!1,angular.element(document.querySelectorAll('#topBar a')).on('click',function(){h()}),a.togglePlatformDropdown=function(){var a=j.platformDropdown;h(),a?c.off('click',i):c.on('click',i),j.platformDropdown=!a},a.toggleUserDropdown=function(){var a=j.userDropdown;h(),a?c.off('click',i):c.on('click',i),j.userDropdown=!a},a.toggleNotifyDropdown=function(){var a=j.notifyDropdown;h(),a?c.off('click',i):c.on('click',i),j.notifyDropdown=!a},a.toggleHelpDropdown=function(){var a=j.helpDropdown;h(),a?c.off('click',i):c.on('click',i),j.helpDropdown=!a},a.signOut=function(){f.perform({action:'resiway_user_signout',next_path:'/',callback:function(a,b){g.clearCredentials()}})},a.search=function(a){b.search.criteria.domain=['title','like','%'+a+'%'],'/questions'==e.path()?d.reload():e.path('/questions')}}]),angular.module('resiexchange').controller('userConfirmController',['$scope','$rootScope','$routeParams','$http','authenticationService',function(a,b,c,d,e){console.log('userConfirm controller');var f=this;f.code=c.code,f.verified=!1,f.password_updated=!1,f.closeAlerts=function(){a.alerts=[]},a.password='',a.confirm='',a.alerts=[],d.get('index.php?do=resiway_user_confirm&code='+f.code).then(function(a){var c=a.data;'undefined'!=typeof a.data.result&&a.data.result===!0&&(f.verified=c.result,'undefined'!=typeof c.notifications&&c.notifications.length>0&&(b.user.notifications=b.user.notifications.concat(c.notifications)),e.authenticate())},function(){}),f.passwordReset=function(){a.alerts=[],0==a.password.length||a.password!=a.confirm?0==a.password.length?a.alerts.push({type:'warning',msg:'Please, provide a new password.'}):0==a.confirm.length?a.alerts.push({type:'warning',msg:'Please, re-type your new password.'}):a.password!=a.confirm&&a.alerts.push({type:'warning',msg:'Confirmation does not match the specified password.'}):d.get('index.php?do=resiway_user_passwordreset&password='+md5(a.password)+'&confirm='+md5(a.confirm)).then(function(a){var b=a.data;'undefined'!=typeof a.data.result&&a.data.result===!0&&(f.password_updated=b.result)},function(){})}}]),angular.module('resiexchange').controller('userEditController',['user','$scope','$window','$filter','$http','$translate','feedbackService','actionService',function(a,b,c,d,e,f,g,h){console.log('userEdit controller');var i=this;i.user=a,i.publicity_mode={id:1,text:'Fullname'},i.modes=[{id:1,text:'Fullname'},{id:2,text:'Firstname + Lastname inital'},{id:3,text:'Firstname only'}],f(['USER_EDIT_PUBLICITY_MODE_FULLNAME','USER_EDIT_PUBLICITY_MODE_FIRSTNAME_L','USER_EDIT_PUBLICITY_MODE_FIRSTNAME']).then(function(a){i.modes[0].text=a.USER_EDIT_PUBLICITY_MODE_FULLNAME,i.modes[1].text=a.USER_EDIT_PUBLICITY_MODE_FIRSTNAME_L,i.modes[2].text=a.USER_EDIT_PUBLICITY_MODE_FIRSTNAME}).then(function(){angular.forEach(i.modes,function(a){a.id==i.user.publicity_mode&&(i.publicity_mode={id:a.id,text:a.text})})}),i.avatars={libravatar:'http://cdn.libravatar.org/avatar/'+md5(i.user.login)+'?s=@size',gravatar:'http://www.gravatar.com/avatar/'+md5(i.user.login)+'?s=@size',identicon:'http://www.gravatar.com/avatar/'+md5(i.user.firstname+i.user.id)+'?d=identicon&s=@size',google:''},e.get('http://picasaweb.google.com/data/entry/api/user/'+i.user.login+'?alt=json').then(function(a){var b=a.data.entry.gphoto$thumbnail.$t;i.avatars.google=b.replace("/s64-c/","/")+'?sz=@size'},function(a){}),b.$watchGroup([function(){return i.publicity_mode},function(){return i.user.firstname},function(){return i.user.lastname}],function(){switch(i.user.publicity_mode=i.publicity_mode.id,i.user.publicity_mode){case 1:i.user.display_name=i.user.firstname+' '+i.user.lastname;break;case 2:var a='';i.user.lastname.length&&(a=i.user.lastname.substr(0,1)+'.'),i.user.display_name=i.user.firstname+' '+a;break;case 3:i.user.display_name=i.user.firstname}}),i.userPost=function(a){var d=g.selector(angular.element(a.target));h.perform({action:'resiway_user_edit',data:{id:i.user.id,firstname:i.user.firstname,lastname:i.user.lastname,publicity_mode:i.user.publicity_mode,language:i.user.language,country:i.user.country,location:i.user.location,about:i.user.about,avatar_url:i.user.avatar_url},scope:b,callback:function(a,b){if('object'!=typeof b.result){var e=b.error_message_ids[0],f=e;g.popover(d,f)}else c.scrollTo(0,0),a.showMessage=!0}})}}]),angular.module('resiexchange').controller('userNotificationsController',['$scope','$rootScope','actionService','feedbackService',function(a,b,c,d){console.log('userNotifications controller');var e=this;e.dismiss=function(e,f){var g=d.selector(e.target);c.perform({action:'resiway_notification_dismiss',data:{notification_id:b.user.notifications[f].id},scope:a,callback:function(a,c){if(c.result===!0)b.user.notifications.splice(f,1);else{var e=c.error_message_ids[0],h=e;d.popover(g,h)}}})}}]),angular.module('resiexchange').controller('userPasswordController',['$scope','$routeParams','$http','authenticationService',function(a,b,c,d){console.log('userPassword controller');var e=this;if(a.password='',a.confirm='',a.alerts=[],e.code=b.code,e.password_updated=!1,e.closeAlerts=function(){a.alerts=[]},'undefined'!=typeof e.code){var f=String(e.code).base64_decode();if(f.indexOf(';')>0){var g=f.split(';');c.get('index.php?do=resiway_user_signin&login='+g[0]+'&password='+g[1]).then(function(a){var b=a.data;'undefined'!=typeof a.data.result&&a.data.result>0&&(e.verified=b.result,d.authenticate())},function(){})}}e.passwordReset=function(){a.alerts=[],0==a.password.length||a.password!=a.confirm?0==a.password.length?a.alerts.push({type:'warning',msg:'Please, provide a new password.'}):0==a.confirm.length?a.alerts.push({type:'warning',msg:'Please, re-type your new password.'}):a.password!=a.confirm&&a.alerts.push({type:'warning',msg:'Confirmation does not match the specified password.'}):c.get('index.php?do=resiway_user_passwordreset&password='+md5(a.password)+'&confirm='+md5(a.confirm)).then(function(a){var b=a.data;'undefined'!=typeof a.data.result&&a.data.result===!0&&(e.password_updated=b.result)},function(){})}}]),angular.module('resiexchange').controller('userProfileController',['user','$scope','$http',function(a,b,c){console.log('userProfile controller');var d=this;d.user=a,d.actions=-1,d.answers=-1,d.favorites=-1;c.get('index.php?do=resiway_user_profileview&id='+a.id),d.load=function(a){a.items=-1,c.post('index.php?get='+a.provider,{domain:a.domain,start:(a.currentPage-1)*a.limit,limit:a.limit,total:a.total}).then(function(b){var c=b.data;a.items=c.result,a.total=c.total},function(){})},angular.merge(d,{updates:{items:-1,total:-1,currentPage:1,limit:5,domain:[[['user_id','=',d.user.id],['user_increment','<>',0]],[['author_id','=',d.user.id],['author_increment','<>',0]]],provider:'resiway_actionlog_list'},questions:{items:-1,total:-1,currentPage:1,limit:5,domain:['creator','=',d.user.id],provider:'resiexchange_question_list'},answers:{items:-1,total:-1,currentPage:1,limit:5,domain:['creator','=',d.user.id],provider:'resiexchange_answer_list'},favorites:{items:-1,total:-1,currentPage:1,limit:5,domain:[['user_id','=',d.user.id],['action_id','=','4']],provider:'resiway_actionlog_list'},actions:{items:-1,total:-1,currentPage:1,limit:5,domain:[['user_id','=',d.user.id]],provider:'resiway_actionlog_list'}})}]),angular.module('resiexchange').controller('userSignController',['$scope','$rootScope','$location','$routeParams','$http','authenticationService',function(a,b,c,d,e,f){console.log('userSign controller');var g=this;switch(g.mode='',d.mode){case'recover':case'in':case'up':g.mode=d.mode}a.remember=!0,a.username='',a.password='',a.firstname='',a.email='',a.signInAlerts=[],a.signUpAlerts=[],a.recoverAlerts=[],g.recovery_sent=!1,g.closeSignInAlerts=function(){a.signInAlerts=[]},g.closeSignInAlert=function(b){a.signInAlerts.splice(b,1)},g.closeSignUpAlerts=function(){a.signUpAlerts=[]},g.closeSignUpAlert=function(b){a.signUpAlerts.splice(b,1)},g.closeRecoverAlerts=function(){a.recoverAlerts=[]},g.closeRecoverAlert=function(b){a.recoverAlerts.splice(b,1)},g.signIn=function(){0==a.username.length||0==a.password.length?0==a.username.length?a.signInAlerts.push({type:'warning',msg:'Please, provide your email as identifier.'}):0==a.password.length&&a.signInAlerts.push({type:'warning',msg:'Please, provide your password.'}):(g.running=!0,g.closeSignInAlerts(),f.setCredentials(a.username,md5(a.password),a.remember),f.authenticate().then(function(a){g.running=!1,c.path(b.pendingAction&&'undefined'!=typeof b.pendingAction.next_path?b.pendingAction.next_path:b.previousPath)},function(){g.running=!1,f.clearCredentials(),a.signInAlerts=[{type:'danger',msg:'Email or password mismatch.'}]}))},g.signUp=function(){0==a.username.length||0==a.firstname.length?0==a.firstname.length?a.signUpAlerts.push({type:'warning',msg:'Please, indicate your firstname.'}):0==a.username.length&&a.signUpAlerts.push({type:'warning',msg:'Please, provide your email as username.'}):(g.running=!0,g.closeSignUpAlerts(),f.register(a.username,a.firstname).then(function(d){g.running=!1,f.authenticate().then(function(a){e.get('index.php?do=resiway_user_pull'),c.path(b.pendingAction&&'undefined'!=typeof b.pendingAction.next_path?b.pendingAction.next_path:b.previousPath)},function(b){f.clearCredentials(),a.signUpAlerts=[{type:'danger',msg:'Sorry, an unexpected error occured.'}]})},function(b){g.running=!1;var c=b.error_message_ids[0];a.signUpAlerts=[{type:'danger',msg:c}]}))},g.recover=function(){0==a.email.length?a.recoverAlerts.push({type:'warning',msg:'Please, provide your email.'}):(g.running=!0,g.closeRecoverAlerts(),e.get('index.php?do=resiway_user_passwordrecover&email='+a.email).then(function(a){g.running=!1;var b=a.data;'undefined'!=typeof a.data.result&&a.data.result===!0&&(g.recovery_sent=b.result)},function(){g.running=!1;var b=data.error_message_ids[0];a.recoverAlerts=[{type:'danger',msg:b}]}))}}]);